
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>ä½“é‡ç®¡ç†ã‚¢ãƒ—ãƒª</title>
    
    <!-- ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ« -->
    <link rel="stylesheet" href="custom/styles.css">
    
    <!-- ã‚¿ãƒ–å›ºæœ‰ã‚¹ã‚¿ã‚¤ãƒ« -->
    <link rel="stylesheet" href="tabs/tab3-room-cleaning/room-cleaning.css">
    <link rel="stylesheet" href="tabs/tab8-memo-list/memo-list.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <!-- Chart.js with date adapter -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    
    <!-- ã‚«ã‚¹ã‚¿ãƒ è¨­å®š -->
    <script type="module" src="custom/app-config.js"></script>
    
    <!-- å…±é€šJavaScripté–¢æ•° -->
    <script src="shared/common-functions.js"></script>
    
    <!-- ã‚¿ãƒ–å›ºæœ‰JavaScript -->
    <!-- ã‚¿ãƒ–ç”¨JSã¯å‹•çš„èª­ã¿è¾¼ã¿ã®ãŸã‚staticèª­ã¿è¾¼ã¿å‰Šé™¤ -->
    <style>
        body { font-family: Arial, sans-serif; padding: 2px; background: #f5f5f5; line-height: 1.2; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 6px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        
        /* æ–‡å­—æ•°åˆ¥ãƒœã‚¿ãƒ³å¹…èª¿æ•´ */
        .timing-btn[data-timing*="å¸°å®…:é£Ÿäº‹æœ‰+åŠæ—¥(7æ™‚é–“ä»¥ä¸Š)"],
        .timing-btn[data-timing*="ã‚ã‚‹ç¨‹åº¦é£²ã‚“ã å¾Œ"] {
            width: 200px !important; /* 3ãƒœã‚¿ãƒ³åˆ† */
            flex-shrink: 0;
        }
        .timing-btn[data-timing*="å¸°å®…:é£Ÿäº‹ç„¡ã—"],
        .timing-btn[data-timing*="å¸°å®…å¾Œ"] {
            width: 140px !important; /* 2ãƒœã‚¿ãƒ³åˆ† */
            flex-shrink: 0;
        }
        
        /* ã‚¹ãƒãƒ›å¯¾å¿œ */
        @media (max-width: 768px) {
            body { padding: 3px; }
            .container { padding: 8px; margin: 0; border-radius: 0; }
            .weight-input { grid-template-columns: 1fr; gap: 8px; }
            .input-card { padding: 8px; }
        }
        .auth-section { background: #e7f3ff; color: #0c5460; padding: 6px; border-radius: 5px; margin-bottom: 6px; text-align: center; }
        .weight-input { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 10px; margin: 8px 0; }
        .input-card { border: 1px solid #ddd; padding: 8px; border-radius: 8px; }
        
        /* ãƒ¡ãƒ¢ãƒªã‚¹ãƒˆç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .memo-item {
            border: 1px solid #ddd;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            background: #fefefe;
        }
        .memo-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 5px;
        }
        .memo-category {
            background: #6c757d;
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            margin-right: 5px;
        }
        .memo-date {
            color: #666;
            font-size: 11px;
        }
        .memo-text {
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 14px;
            line-height: 1.4;
            color: #333;  /* æ–‡å­—ã‚’æ¿ƒãã—ã¦èª­ã¿ã‚„ã™ã */
            font-weight: 500;  /* ã‚„ã‚„å¤ªã‚ã«ã—ã¦è¦–èªæ€§å‘ä¸Š */
        }
        .memo-delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 2px 6px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 10px;
            margin-left: 10px;
        }
        .memo-delete-btn:hover {
            background: #c82333;
        }
        
        /* ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãƒ‘ãƒãƒ«ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .timing-panel { 
            background: #f8f9fa; 
            border: 2px solid #e9ecef; 
            border-radius: 8px; 
            padding: 8px; 
            margin: 5px 0; 
        }
        .timing-buttons { 
            display: flex; 
            gap: 4px; 
            flex-wrap: wrap; 
            justify-content: center;
        }
        .timing-btn { 
            background: #6c757d; 
            color: white; 
            border: none; 
            padding: 6px 8px; 
            border-radius: 12px; 
            cursor: pointer; 
            font-size: 11px;
            transition: all 0.2s;
            min-width: 85px;
            text-align: center;
            flex: 1;
            max-width: 120px;
        }
        .timing-btn:hover {
            transform: scale(1.05);
        }
        .timing-btn.selected {
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        
        @media (max-width: 768px) {
            .timing-buttons { gap: 3px; }
            .timing-btn { 
                padding: 4px 6px; 
                font-size: 10px;
                min-width: 75px;
            }
        }

        /* æœè£…ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«çµ±ä¸€ */
        .clothing-btn {
            border: none;
            padding: 6px 8px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 10px;
            min-width: 85px;
            text-align: center;
            transition: all 0.2s;
            flex: 1;
            max-width: 120px;
        }
        .clothing-btn:hover {
            transform: scale(1.05);
        }

        @media (max-width: 768px) {
            .clothing-btn {
                padding: 4px 6px;
                min-width: 75px;
                font-size: 9px;
            }
        }
        .input-field { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; margin: 5px 0; font-size: 16px; }
        .save-button { background: #28a745; color: white; border: none; padding: 12px 24px; border-radius: 5px; cursor: pointer; margin: 5px; font-size: 16px; }
        .save-button:hover { background: #218838; }
        .auth-button { background: #4285f4; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        .auth-button:hover { background: #357ae8; }
        .logout-button { background: #dc3545; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; margin: 5px; }
        .data-area { background: #f8f9fa; border: 1px solid #dee2e6; padding: 8px; border-radius: 5px; font-family: monospace; min-height: 120px; }
        .hidden { display: none; }
        .user-info { background: #d4edda; color: #155724; padding: 4px 6px; border-radius: 5px; margin-bottom: 6px; font-size: 13px; }
    </style>
</head>
<body>
    <div class="container">
        <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±è¡¨ç¤ºï¼ˆä¸€ç•ªä¸Šï¼‰ -->
        <div class="user-info hidden" id="userInfo" style="margin-bottom: 10px;">
            <span>ğŸ‘¤ ãƒ­ã‚°ã‚¤ãƒ³ä¸­: <span id="userName"></span></span>
            <button class="logout-button" onclick="handleLogout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
        </div>

        <!-- ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
        <div id="tabNavigation" class="hidden" style="margin-bottom: 15px;">
            <div style="display: flex; border-bottom: 2px solid #ddd; flex-wrap: wrap;">
                <button id="tab1" class="tab-btn active" onclick="switchTab(1)" style="flex: 1; min-width: 80px; padding: 8px 10px; border: none; background: #007bff; color: white; cursor: pointer; border-radius: 5px 5px 0 0; margin-right: 1px; margin-bottom: 1px; font-size: 12px;">ä½“é‡</button>
                <button id="tab2" class="tab-btn" onclick="switchTab(2)" style="flex: 1; min-width: 80px; padding: 8px 10px; border: none; background: #f8f9fa; color: #495057; cursor: pointer; border-radius: 5px 5px 0 0; margin-right: 1px; margin-bottom: 1px; font-size: 12px;">ç¡çœ </button>
                <button id="tab3" class="tab-btn" onclick="switchTab(3)" style="flex: 1; min-width: 80px; padding: 8px 10px; border: none; background: #f8f9fa; color: #495057; cursor: pointer; border-radius: 5px 5px 0 0; margin-right: 1px; margin-bottom: 1px; font-size: 12px;">éƒ¨å±‹ç‰‡ã¥ã‘</button>
                <button id="tab4" class="tab-btn" onclick="switchTab(4)" style="flex: 1; min-width: 80px; padding: 8px 10px; border: none; background: #f8f9fa; color: #495057; cursor: pointer; border-radius: 5px 5px 0 0; margin-right: 1px; margin-bottom: 1px; font-size: 12px;">ã‚¹ãƒˆãƒ¬ãƒƒãƒ</button>
                <button id="tab5" class="tab-btn" onclick="switchTab(5)" style="flex: 1; min-width: 80px; padding: 8px 10px; border: none; background: #f8f9fa; color: #495057; cursor: pointer; border-radius: 5px 5px 0 0; margin-right: 1px; margin-bottom: 1px; font-size: 12px;">xx5</button>
                <button id="tab6" class="tab-btn" onclick="switchTab(6)" style="flex: 1; min-width: 80px; padding: 8px 10px; border: none; background: #f8f9fa; color: #495057; cursor: pointer; border-radius: 5px 5px 0 0; margin-right: 1px; margin-bottom: 1px; font-size: 12px;">xx6</button>
                <button id="tab7" class="tab-btn" onclick="switchTab(7)" style="flex: 1; min-width: 80px; padding: 8px 10px; border: none; background: #f8f9fa; color: #495057; cursor: pointer; border-radius: 5px 5px 0 0; margin-right: 1px; margin-bottom: 1px; font-size: 12px;">xx7</button>
                <button id="tab8" class="tab-btn" onclick="switchTab(8)" style="flex: 1; min-width: 80px; padding: 8px 10px; border: none; background: #f8f9fa; color: #495057; cursor: pointer; border-radius: 5px 5px 0 0; margin-right: 1px; margin-bottom: 1px; font-size: 12px;">ãƒ¡ãƒ¢ãƒªã‚¹ãƒˆ</button>
            </div>
            <!-- 2è¡Œç›®ã®ã‚¿ãƒ–ï¼ˆ9-16ï¼‰ -->
            <div style="display: flex; border-bottom: 2px solid #ddd; flex-wrap: wrap;">
                <button id="tab9" class="tab-btn" onclick="switchTab(9)" style="flex: 1; min-width: 80px; padding: 8px 10px; border: none; background: #f8f9fa; color: #495057; cursor: pointer; border-radius: 5px 5px 0 0; margin-right: 1px; margin-bottom: 1px; font-size: 12px;">xx9</button>
                <button id="tab10" class="tab-btn" onclick="switchTab(10)" style="flex: 1; min-width: 80px; padding: 8px 10px; border: none; background: #f8f9fa; color: #495057; cursor: pointer; border-radius: 5px 5px 0 0; margin-right: 1px; margin-bottom: 1px; font-size: 12px;">xx10</button>
                <button id="tab11" class="tab-btn" onclick="switchTab(11)" style="flex: 1; min-width: 80px; padding: 8px 10px; border: none; background: #f8f9fa; color: #495057; cursor: pointer; border-radius: 5px 5px 0 0; margin-right: 1px; margin-bottom: 1px; font-size: 12px;">xx11</button>
                <button id="tab12" class="tab-btn" onclick="switchTab(12)" style="flex: 1; min-width: 80px; padding: 8px 10px; border: none; background: #f8f9fa; color: #495057; cursor: pointer; border-radius: 5px 5px 0 0; margin-right: 1px; margin-bottom: 1px; font-size: 12px;">xx12</button>
                <button id="tab13" class="tab-btn" onclick="switchTab(13)" style="flex: 1; min-width: 80px; padding: 8px 10px; border: none; background: #f8f9fa; color: #495057; cursor: pointer; border-radius: 5px 5px 0 0; margin-right: 1px; margin-bottom: 1px; font-size: 12px;">xx13</button>
                <button id="tab14" class="tab-btn" onclick="switchTab(14)" style="flex: 1; min-width: 80px; padding: 8px 10px; border: none; background: #f8f9fa; color: #495057; cursor: pointer; border-radius: 5px 5px 0 0; margin-right: 1px; margin-bottom: 1px; font-size: 12px;">xx14</button>
                <button id="tab15" class="tab-btn" onclick="switchTab(15)" style="flex: 1; min-width: 80px; padding: 8px 10px; border: none; background: #f8f9fa; color: #495057; cursor: pointer; border-radius: 5px 5px 0 0; margin-right: 1px; margin-bottom: 1px; font-size: 12px;">xx15</button>
                <button id="tab16" class="tab-btn" onclick="switchTab(16)" style="flex: 1; min-width: 80px; padding: 8px 10px; border: none; background: #f8f9fa; color: #495057; cursor: pointer; border-radius: 5px 5px 0 0; margin-bottom: 1px; font-size: 12px;">xx16</button>
            </div>
        </div>

        <!-- ã‚¢ãƒ—ãƒªã‚¿ã‚¤ãƒˆãƒ« -->
        <div class="app-header hidden" id="appHeader">
            <h1 class="app-title" id="appTitle">ğŸ“Š ä½“é‡ç®¡ç†ã‚¢ãƒ—ãƒª</h1>
            <p class="app-subtitle">Core/Customãƒ•ã‚©ãƒ«ãƒ€åˆ†é›¢ç‰ˆ - Firebase + Googleèªè¨¼</p>
        </div>

        <!-- èªè¨¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="auth-section" id="authSection">
            <h1 class="app-title">ğŸ“Š ä½“é‡ç®¡ç†ã‚¢ãƒ—ãƒª</h1>
            <p class="app-subtitle">Core/Customãƒ•ã‚©ãƒ«ãƒ€åˆ†é›¢ç‰ˆ - Firebase + Googleèªè¨¼</p>
            <h3>ğŸ” ãƒ­ã‚°ã‚¤ãƒ³</h3>
            <p>Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ãƒ»åŒæœŸã§ãã¾ã™</p>
            <button class="auth-button" onclick="handleGoogleLogin()">Googleã§ãƒ­ã‚°ã‚¤ãƒ³</button>
        </div>

        <!-- ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
        <div id="tabContent1" class="tab-content">
            <!-- ä½“é‡ç®¡ç†ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯å‹•çš„èª­ã¿è¾¼ã¿ -->
        </div>

        <!-- å…±é€šãƒ­ã‚°ã‚¨ãƒªã‚¢ï¼ˆå…¨ã‚¿ãƒ–ç”¨ï¼‰ -->
        <div class="hidden" id="globalLogArea">
            <h3>ğŸ“‹ ã‚¢ãƒ—ãƒªãƒ­ã‚° <button class="universal-copy-btn" onclick="copyLogs()" style="background: #28a745; color: white; border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer; font-size: 12px;">ğŸ“‹ ãƒ­ã‚°ã‚’ã‚³ãƒ”ãƒ¼</button></h3>
            <div class="data-area" id="logArea">
                ã‚¢ãƒ—ãƒªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆèµ·å‹•å®Œäº†...<br>
                ğŸ”¥ Firebaseè¨­å®šå®Œäº†<br>
                ğŸ” Googleèªè¨¼æº–å‚™å®Œäº†<br>
            </div>
            
            <!-- ãƒ‡ãƒãƒƒã‚°ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ -->
            <div style="margin-top: 8px; text-align: center;">
                <button class="universal-copy-btn" onclick="debugFirebaseConnection()" style="background: #ff6b6b; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; margin: 5px;">ğŸ” Firebase Debug</button>
                <button class="universal-copy-btn" onclick="checkLoginIssues()" style="background: #ffc107; color: #212529; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; margin: 5px;">âš ï¸ ãƒ­ã‚°ã‚¤ãƒ³å•é¡Œè¨ºæ–­</button>
                <button class="universal-copy-btn" onclick="copyDebugInfo()" style="background: #17a2b8; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; margin: 5px;">ğŸ“‹ ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’ã‚³ãƒ”ãƒ¼</button>
                <button class="universal-copy-btn" onclick="checkDatabaseStructure()" style="background: #6f42c1; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; margin: 5px;">ğŸ—ï¸ DBæ§‹é€ ç¢ºèª</button>
                <button class="universal-copy-btn" onclick="checkMobileSupport()" style="background: #28a745; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; margin: 5px;">ğŸ“± ãƒ¢ãƒã‚¤ãƒ«è¨ºæ–­</button>
                <button class="universal-copy-btn" onclick="forceAuthCheck()" style="background: #fd7e14; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; margin: 5px;">ğŸ”„ èªè¨¼çŠ¶æ…‹ç¢ºèª</button>
                <button class="universal-copy-btn" onclick="checkFirebaseConfig()" style="background: #dc3545; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; margin: 5px;">ğŸ”§ Firebaseè¨­å®š</button>
                <button class="universal-copy-btn" onclick="testPopup()" style="background: #20c997; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; margin: 5px;">ğŸ§ª ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒ†ã‚¹ãƒˆ</button>
            </div>
        </div>


        <!-- ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„2 -->
        <div id="tabContent2" class="tab-content hidden">
            <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯å‹•çš„èª­ã¿è¾¼ã¿ -->
        </div>

        <!-- ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„3 -->
        <div id="tabContent3" class="tab-content hidden">
            <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯å‹•çš„èª­ã¿è¾¼ã¿ -->
        </div>

        <!-- ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„4 -->
        <div id="tabContent4" class="tab-content hidden">
            <div style="text-align: center; padding: 50px; color: #666;">
                <h3>ğŸ”§ xx4</h3>
                <p>ã“ã¡ã‚‰ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯å¾Œã§å®Ÿè£…äºˆå®šã§ã™</p>
            </div>
        </div>

        <!-- ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„5 -->
        <div id="tabContent5" class="tab-content hidden">
            <div style="text-align: center; padding: 50px; color: #666;">
                <h3>ğŸ”§ xx5</h3>
                <p>ã“ã¡ã‚‰ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯å¾Œã§å®Ÿè£…äºˆå®šã§ã™</p>
            </div>
        </div>

        <!-- ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„6 -->
        <div id="tabContent6" class="tab-content hidden">
            <div style="text-align: center; padding: 50px; color: #666;">
                <h3>ğŸ”§ xx6</h3>
                <p>ã“ã¡ã‚‰ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯å¾Œã§å®Ÿè£…äºˆå®šã§ã™</p>
            </div>
        </div>

        <!-- ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„7 -->
        <div id="tabContent7" class="tab-content hidden">
            <div style="text-align: center; padding: 50px; color: #666;">
                <h3>ğŸ”§ xx7</h3>
                <p>ã“ã¡ã‚‰ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯å¾Œã§å®Ÿè£…äºˆå®šã§ã™</p>
            </div>
        </div>

        <!-- ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„8: ãƒ¡ãƒ¢ãƒªã‚¹ãƒˆ -->
        <div id="tabContent8" class="tab-content hidden">
            <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯å‹•çš„èª­ã¿è¾¼ã¿ -->
        </div>

        <!-- ã‚¿ãƒ–9-16ã®ç©ºã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
        <div id="tabContent9" class="tab-content hidden">
            <div style="text-align: center; padding: 50px; color: #666;">
                <h3>ğŸ”§ xx9</h3>
                <p>ã“ã®ã‚¿ãƒ–ã¯ã¾ã å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
            </div>
        </div>

        <div id="tabContent10" class="tab-content hidden">
            <div style="text-align: center; padding: 50px; color: #666;">
                <h3>ğŸ”§ xx10</h3>
                <p>ã“ã®ã‚¿ãƒ–ã¯ã¾ã å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
            </div>
        </div>

        <div id="tabContent11" class="tab-content hidden">
            <div style="text-align: center; padding: 50px; color: #666;">
                <h3>ğŸ”§ xx11</h3>
                <p>ã“ã®ã‚¿ãƒ–ã¯ã¾ã å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
            </div>
        </div>

        <div id="tabContent12" class="tab-content hidden">
            <div style="text-align: center; padding: 50px; color: #666;">
                <h3>ğŸ”§ xx12</h3>
                <p>ã“ã®ã‚¿ãƒ–ã¯ã¾ã å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
            </div>
        </div>

        <div id="tabContent13" class="tab-content hidden">
            <div style="text-align: center; padding: 50px; color: #666;">
                <h3>ğŸ”§ xx13</h3>
                <p>ã“ã®ã‚¿ãƒ–ã¯ã¾ã å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
            </div>
        </div>

        <div id="tabContent14" class="tab-content hidden">
            <div style="text-align: center; padding: 50px; color: #666;">
                <h3>ğŸ”§ xx14</h3>
                <p>ã“ã®ã‚¿ãƒ–ã¯ã¾ã å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
            </div>
        </div>

        <div id="tabContent15" class="tab-content hidden">
            <div style="text-align: center; padding: 50px; color: #666;">
                <h3>ğŸ”§ xx15</h3>
                <p>ã“ã®ã‚¿ãƒ–ã¯ã¾ã å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
            </div>
        </div>

        <div id="tabContent16" class="tab-content hidden">
            <div style="text-align: center; padding: 50px; color: #666;">
                <h3>ğŸ”§ xx16</h3>
                <p>ã“ã®ã‚¿ãƒ–ã¯ã¾ã å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
            </div>
        </div>
    </div>

    <script>
        // Core Firebaseè¨­å®šï¼ˆå¤‰æ›´ç¦æ­¢ - core/src/firebase-config.jså‚ç…§ï¼‰
        const firebaseConfig = {
            apiKey: "AIzaSyA5PXKChizYDCXF_GJ4KL6Ylq9K5hCPXWE",
            authDomain: "shares-b1b97.firebaseapp.com",
            databaseURL: "https://shares-b1b97-default-rtdb.firebaseio.com",
            projectId: "shares-b1b97",
            storageBucket: "shares-b1b97.firebasestorage.app",
            messagingSenderId: "38311063248",
            appId: "1:38311063248:web:0d2d5726d12b305b24b8d5"
        };

        // FirebaseåˆæœŸåŒ–
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        let currentUser = null;
        let selectedTimingValue = '';
        let selectedTopValue = '';
        let selectedBottomValue = '';
        let weightChart = null;
        let allWeightData = [];
        window.editingEntryId = null;

        // çµ±ä¸€ãƒ¢ãƒ¼ãƒ‰çŠ¶æ…‹ç®¡ç†
        let currentMode = 'normal'; // 'normal', 'add', 'delete'
        let selectedTarget = null; // 'timing', 'top', 'bottom' ã®ã„ãšã‚Œã‹

        // å‰æœŸé–“æ¯”è¼ƒæ©Ÿèƒ½ã®çŠ¶æ…‹ç®¡ç†

        // ã‚¢ãƒ—ãƒªãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆä¸€å…ƒç®¡ç†ï¼‰
        const APP_VERSION = 'v1.99';
        
        // ã‚«ãƒ©ãƒ¼é…åˆ—å®šæ•°åŒ–ï¼ˆ3ç®‡æ‰€ã®é‡è¤‡çµ±ä¸€ï¼‰
        const RANDOM_COLORS = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#f9ca24', '#f0932b', '#eb4d4b', '#6c5ce7', '#a55eea'];

        // ã‚«ã‚¹ã‚¿ãƒ é …ç›®ã®æ°¸ç¶šåŒ–æ©Ÿèƒ½ï¼ˆlocalStorageæ´»ç”¨ï¼‰
        const STORAGE_KEYS = {
            customTimings: 'weightApp_customTimings',
            customTops: 'weightApp_customTops',
            customBottoms: 'weightApp_customBottoms'
        };

        // ã‚«ã‚¹ã‚¿ãƒ é …ç›®é–¢é€£ã®é–¢æ•°ã¯ tabs/tab1-weight/tab-weight.js ã«ç§»å‹•æ¸ˆã¿





        // çµ±ä¸€ãƒ¢ãƒ¼ãƒ‰ã‚·ã‚¹ãƒ†ãƒ å®Œäº† - å¤ã„å€‹åˆ¥é–¢æ•°ç¾¤ã¯å‰Šé™¤æ¸ˆã¿

        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã§ã®å€¤èª¿æ•´æ©Ÿèƒ½
        window.handleWeightKeypress = (event) => {
            const weightInput = document.getElementById('weightValue');
            const currentValue = parseFloat(weightInput.value) || 72.0;
            
            if (event.key === 'ArrowUp') {
                event.preventDefault();
                weightInput.value = (currentValue + 0.1).toFixed(1);
            } else if (event.key === 'ArrowDown') {
                event.preventDefault();
                weightInput.value = Math.max(0, currentValue - 0.1).toFixed(1);
            }
        };

        // ã‚¿ã‚¤ãƒŸãƒ³ã‚°é¸æŠæ©Ÿèƒ½ï¼ˆæ”¹è‰¯ç‰ˆï¼‰
        window.selectTiming = (timing) => {
            selectedTimingValue = timing;
            document.getElementById('selectedTiming').value = timing;
            
            // ã™ã¹ã¦ã®ãƒœã‚¿ãƒ³ã‹ã‚‰é¸æŠçŠ¶æ…‹ã‚’å‰Šé™¤
            document.querySelectorAll('.timing-btn').forEach(btn => {
                btn.classList.remove('selected');
                btn.style.opacity = '0.7';
            });
            
            // é¸æŠã•ã‚ŒãŸãƒœã‚¿ãƒ³ã«é¸æŠçŠ¶æ…‹ã‚’è¿½åŠ 
            const selectedBtn = document.querySelector(`[data-timing="${timing}"]`);
            if (selectedBtn) {
                selectedBtn.classList.add('selected');
                selectedBtn.style.opacity = '1';
            }
            
            log(`â° æ¸¬å®šã‚¿ã‚¤ãƒŸãƒ³ã‚°é¸æŠ: ${timing}`);
        };

        // ä¸ŠåŠèº«æœè£…é¸æŠæ©Ÿèƒ½
        window.selectClothingTop = (clothing) => {
            selectedTopValue = clothing;
            document.getElementById('selectedTop').value = clothing;
            
            // ã™ã¹ã¦ã®ä¸ŠåŠèº«ãƒœã‚¿ãƒ³ã‹ã‚‰é¸æŠçŠ¶æ…‹ã‚’å‰Šé™¤
            document.querySelectorAll('.clothing-btn[data-clothing-top]').forEach(btn => {
                btn.style.opacity = '0.7';
                btn.style.transform = 'scale(1)';
            });
            
            // é¸æŠã•ã‚ŒãŸãƒœã‚¿ãƒ³ã«é¸æŠçŠ¶æ…‹ã‚’è¿½åŠ 
            const selectedBtn = document.querySelector(`[data-clothing-top="${clothing}"]`);
            if (selectedBtn) {
                selectedBtn.style.opacity = '1';
                selectedBtn.style.transform = 'scale(1.05)';
            }
            
            log(`ğŸ‘• ä¸ŠåŠèº«é¸æŠ: ${clothing}`);
        };

        // ä¸‹åŠèº«æœè£…é¸æŠæ©Ÿèƒ½
        window.selectClothingBottom = (clothing) => {
            selectedBottomValue = clothing;
            document.getElementById('selectedBottom').value = clothing;
            
            // ã™ã¹ã¦ã®ä¸‹åŠèº«ãƒœã‚¿ãƒ³ã‹ã‚‰é¸æŠçŠ¶æ…‹ã‚’å‰Šé™¤
            document.querySelectorAll('.clothing-btn[data-clothing-bottom]').forEach(btn => {
                btn.style.opacity = '0.7';
                btn.style.transform = 'scale(1)';
            });
            
            // é¸æŠã•ã‚ŒãŸãƒœã‚¿ãƒ³ã«é¸æŠçŠ¶æ…‹ã‚’è¿½åŠ 
            const selectedBtn = document.querySelector(`[data-clothing-bottom="${clothing}"]`);
            if (selectedBtn) {
                selectedBtn.style.opacity = '1';
                selectedBtn.style.transform = 'scale(1.05)';
            }
            
            log(`ğŸ©² ä¸‹åŠèº«é¸æŠ: ${clothing}`);
        };

        // çµ±ä¸€ã‚«ã‚¹ã‚¿ãƒ é …ç›®è¿½åŠ ã‚·ã‚¹ãƒ†ãƒ ï¼ˆaddCustomClothingTop ã¯çµ±ä¸€ãƒ¢ãƒ¼ãƒ‰ã«ç§»è¡Œï¼‰

        window.addTopCustomItem = () => {
            const newItem = document.getElementById('topCustomText').value.trim();
            if (newItem) {
                const container = document.getElementById('topClothingButtons');
                
                // ãƒ©ãƒ³ãƒ€ãƒ ã‚«ãƒ©ãƒ¼ç”Ÿæˆï¼ˆçµ±ä¸€å®šæ•°ä½¿ç”¨ï¼‰
                // const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#f9ca24', '#f0932b', '#eb4d4b', '#6c5ce7', '#a55eea']; // é‡è¤‡å‰Šé™¤
                const randomColor = RANDOM_COLORS[Math.floor(Math.random() * RANDOM_COLORS.length)];
                
                const button = document.createElement('button');
                button.type = 'button';
                button.className = 'clothing-btn';
                button.setAttribute('data-clothing-top', newItem);
                button.onclick = () => selectClothingTop(newItem);
                button.style.cssText = `background: ${randomColor}; color: white; opacity: 0.7;`;
                button.setAttribute('data-original-color', randomColor);
                button.textContent = `ğŸ‘” ${newItem}`;
                
                container.appendChild(button);
                log(`âœ… æ–°ã—ã„ä¸ŠåŠèº«é …ç›®è¿½åŠ : ${newItem}`);
                
                // è¿½åŠ å¾Œã™ãã«é¸æŠ
                selectClothingTop(newItem);
                
                // ã‚«ã‚¹ã‚¿ãƒ é …ç›®ã‚’æ°¸ç¶šåŒ–ä¿å­˜
                saveCustomItems();
                
                // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ãƒªã‚»ãƒƒãƒˆãƒ»éè¡¨ç¤º
                document.getElementById('topCustomText').value = '';
                document.getElementById('topCustomInput').style.display = 'none';
            }
        };

        window.cancelTopCustom = () => {
            document.getElementById('topCustomText').value = '';
            document.getElementById('topCustomInput').style.display = 'none';
        };

        // ã‚«ã‚¹ã‚¿ãƒ ä¸‹åŠèº«é …ç›®è¿½åŠ ï¼ˆæ”¹è‰¯ç‰ˆ - ã‚¹ãƒãƒ›å¯¾å¿œï¼‰
        window.addCustomClothingBottom = () => {
            document.getElementById('bottomCustomInput').style.display = 'block';
            document.getElementById('bottomCustomText').focus();
        };

        window.addBottomCustomItem = () => {
            const newItem = document.getElementById('bottomCustomText').value.trim();
            if (newItem) {
                const container = document.getElementById('bottomClothingButtons');
                
                // ãƒ©ãƒ³ãƒ€ãƒ ã‚«ãƒ©ãƒ¼ç”Ÿæˆï¼ˆçµ±ä¸€å®šæ•°ä½¿ç”¨ï¼‰
                // const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#f9ca24', '#f0932b', '#eb4d4b', '#6c5ce7', '#a55eea']; // é‡è¤‡å‰Šé™¤
                const randomColor = RANDOM_COLORS[Math.floor(Math.random() * RANDOM_COLORS.length)];
                
                const button = document.createElement('button');
                button.type = 'button';
                button.className = 'clothing-btn';
                button.setAttribute('data-clothing-bottom', newItem);
                button.onclick = () => selectClothingBottom(newItem);
                button.style.cssText = `background: ${randomColor}; color: white; opacity: 0.7;`;
                button.setAttribute('data-original-color', randomColor);
                button.textContent = `ğŸ‘– ${newItem}`;
                
                container.appendChild(button);
                log(`âœ… æ–°ã—ã„ä¸‹åŠèº«é …ç›®è¿½åŠ : ${newItem}`);
                
                // è¿½åŠ å¾Œã™ãã«é¸æŠ
                selectClothingBottom(newItem);
                
                // ã‚«ã‚¹ã‚¿ãƒ é …ç›®ã‚’æ°¸ç¶šåŒ–ä¿å­˜
                saveCustomItems();
                
                // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ãƒªã‚»ãƒƒãƒˆãƒ»éè¡¨ç¤º
                document.getElementById('bottomCustomText').value = '';
                document.getElementById('bottomCustomInput').style.display = 'none';
            }
        };

        window.cancelBottomCustom = () => {
            document.getElementById('bottomCustomText').value = '';
            document.getElementById('bottomCustomInput').style.display = 'none';
        };

        // ã‚«ã‚¹ã‚¿ãƒ ã‚¿ã‚¤ãƒŸãƒ³ã‚°é …ç›®è¿½åŠ ï¼ˆæ”¹è‰¯ç‰ˆ - ã‚¹ãƒãƒ›å¯¾å¿œï¼‰
        window.addCustomTiming = () => {
            document.getElementById('timingCustomInput').style.display = 'block';
            document.getElementById('timingCustomText').focus();
        };

        window.addTimingCustomItem = () => {
            const newItem = document.getElementById('timingCustomText').value.trim();
            if (newItem) {
                const container = document.getElementById('timingButtons');
                
                // ãƒ©ãƒ³ãƒ€ãƒ ã‚«ãƒ©ãƒ¼ç”Ÿæˆï¼ˆçµ±ä¸€å®šæ•°ä½¿ç”¨ï¼‰
                // const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#f9ca24', '#f0932b', '#eb4d4b', '#6c5ce7', '#a55eea']; // é‡è¤‡å‰Šé™¤
                const randomColor = RANDOM_COLORS[Math.floor(Math.random() * RANDOM_COLORS.length)];
                
                const button = document.createElement('button');
                button.type = 'button';
                button.className = 'timing-btn';
                button.setAttribute('data-timing', newItem);
                button.onclick = () => selectTiming(newItem);
                button.style.cssText = `background: ${randomColor}; color: white; opacity: 0.7;`;
                button.setAttribute('data-original-color', randomColor);
                button.textContent = `â° ${newItem}`;
                
                container.appendChild(button);
                log(`âœ… æ–°ã—ã„ã‚¿ã‚¤ãƒŸãƒ³ã‚°é …ç›®è¿½åŠ : ${newItem}`);
                
                // è¿½åŠ å¾Œã™ãã«é¸æŠ
                selectTiming(newItem);
                
                // ã‚«ã‚¹ã‚¿ãƒ é …ç›®ã‚’æ°¸ç¶šåŒ–ä¿å­˜
                saveCustomItems();
                
                // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ãƒªã‚»ãƒƒãƒˆãƒ»éè¡¨ç¤º
                document.getElementById('timingCustomText').value = '';
                document.getElementById('timingCustomInput').style.display = 'none';
            }
        };

        window.cancelTimingCustom = () => {
            document.getElementById('timingCustomText').value = '';
            document.getElementById('timingCustomInput').style.display = 'none';
        };


        // èªè¨¼çŠ¶æ…‹ã®ç›£è¦–ï¼ˆæ”¹è‰¯ç‰ˆ + ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå¯¾å¿œï¼‰
        auth.onAuthStateChanged(async (user) => {
            currentUser = user;
            if (user) {
                log(`âœ… èªè¨¼çŠ¶æ…‹ç¢ºèª: ${user.displayName} ã§ãƒ­ã‚°ã‚¤ãƒ³ä¸­`);
                log(`ğŸ“§ ãƒ¡ãƒ¼ãƒ«: ${user.email}`);
                showUserInterface(user);
                log('ğŸ”„ ä½“é‡ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿é–‹å§‹...');
                loadUserWeightData(user.uid);
            } else {
                // ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆçµæœã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆiPhoneå¯¾å¿œï¼‰
                try {
                    const result = await auth.getRedirectResult();
                    if (result.user) {
                        log(`âœ… ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ: ${result.user.displayName}`);
                    }
                } catch (error) {
                    // ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚¨ãƒ©ãƒ¼ã¯ç„¡è¦–ï¼ˆåˆå›ã‚¢ã‚¯ã‚»ã‚¹æ™‚ãªã©ï¼‰
                }
                log('ğŸ”’ èªè¨¼çŠ¶æ…‹: æœªãƒ­ã‚°ã‚¤ãƒ³');
                showLoginInterface();
            }
        });

        // åˆæœŸåŒ–å®Œäº†ãƒ­ã‚°
        log('ğŸ”„ Firebaseèªè¨¼ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº† - èªè¨¼çŠ¶æ…‹ã‚’ç¢ºèªä¸­...');

        // Googleãƒ­ã‚°ã‚¤ãƒ³ï¼ˆæ”¹è‰¯ç‰ˆ - ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒ–ãƒ­ãƒƒã‚¯æ¤œçŸ¥ä»˜ãï¼‰
        window.handleGoogleLogin = async () => {
            try {
                log('ğŸ” Googleãƒ­ã‚°ã‚¤ãƒ³é–‹å§‹...');
                const provider = new firebase.auth.GoogleAuthProvider();
                
                // ãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒã‚¤ã‚¹æ¤œå‡ºï¼ˆiPhoneå°‚ç”¨å¯¾å¿œï¼‰
                const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                const isIPhone = /iPhone|iPad|iPod/i.test(navigator.userAgent);
                
                // iPhoneã¯ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆæ–¹å¼ã€ãã‚Œä»¥å¤–ã¯ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—æ–¹å¼
                if (isIPhone) {
                    log('ğŸ“± iPhone/iPadæ¤œå‡º - ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆæ–¹å¼ã§ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆSafariå¯¾å¿œï¼‰');
                    log('ğŸ”„ ãƒšãƒ¼ã‚¸ãŒGoogleã«ç§»å‹•ã—ã¾ã™...');
                    // ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆæ–¹å¼ï¼ˆiPhoneå°‚ç”¨ï¼‰
                    await auth.signInWithRedirect(provider);
                    return; // ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã‚‹ã®ã§ã“ã“ã§çµ‚äº†
                } else if (isMobile) {
                    log('ğŸ“± ãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒã‚¤ã‚¹æ¤œå‡º - ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—æ–¹å¼ã§ãƒ­ã‚°ã‚¤ãƒ³');
                    log('ğŸ’¡ ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒé€”ä¸­ã§æ­¢ã¾ã‚‹å ´åˆã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶è¨­å®šã®ç¢ºèªãŒå¿…è¦ã§ã™');
                } else {
                    log('ğŸ–¥ï¸ ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ãƒ‡ãƒã‚¤ã‚¹ - ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—æ–¹å¼ã§ãƒ­ã‚°ã‚¤ãƒ³');
                }
                
                // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒ–ãƒ­ãƒƒã‚¯æ¤œçŸ¥ã®ãŸã‚ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®šï¼ˆiPhoneä»¥å¤–ï¼‰
                log('ğŸªŸ ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§Googleãƒ­ã‚°ã‚¤ãƒ³ã‚’é–‹å§‹...');
                
                const loginPromise = auth.signInWithPopup(provider);
                
                // ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ¤œçŸ¥ï¼ˆ15ç§’ã§ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒé–‹ã‹ãªã„å ´åˆï¼‰
                const timeoutPromise = new Promise((_, reject) => {
                    setTimeout(() => {
                        reject(new Error('ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ - ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚ŒãŸå¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™'));
                    }, 15000);  // å…ƒã®15ç§’ã«æˆ»ã™ï¼ˆiPhoneä»¥å¤–ç”¨ï¼‰
                });
                
                try {
                    const result = await Promise.race([loginPromise, timeoutPromise]);
                    log(`âœ… ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ: ${result.user.displayName}`);
                } catch (raceError) {
                    // ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã®å ´åˆã®ç‰¹åˆ¥å‡¦ç†
                    if (raceError.message.includes('ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ')) {
                        log('â° ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒ15ç§’ä»¥å†…ã«é–‹ãã¾ã›ã‚“ã§ã—ãŸ');
                        log('ğŸ”„ ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒ–ãƒ­ãƒƒã‚¯æ¤œçŸ¥ - è§£æ±ºæ–¹æ³•ã‚’ã”æ¡ˆå†…ã—ã¾ã™');
                        throw new Error('POPUP_TIMEOUT');
                    } else {
                        throw raceError;
                    }
                }
                
            } catch (error) {
                log(`âŒ ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                
                // ã‚¨ãƒ©ãƒ¼ã®è©³ç´°æƒ…å ±ã‚’ãƒ­ã‚°ã«å‡ºåŠ›
                if (error.code) {
                    log(`- ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰: ${error.code}`);
                    
                    // ç‰¹å®šã®ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã«å¯¾ã™ã‚‹è§£æ±ºç­–ã‚’æç¤º
                    switch(error.code) {
                        case 'auth/unauthorized-domain':
                            log('ğŸ’¡ ãƒ‰ãƒ¡ã‚¤ãƒ³è¨±å¯è¨­å®šã®å•é¡Œã§ã™');
                            log('ğŸ’¡ Firebase Consoleã§èªè¨¼ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ç¢ºèªã—ã¦ãã ã•ã„');
                            break;
                        case 'auth/popup-blocked':
                            log('ğŸ’¡ ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ');
                            showPopupGuide(isMobile);
                            break;
                        case 'auth/popup-closed-by-user':
                            log('ğŸ’¡ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‰ã˜ã¾ã—ãŸ');
                            log('ğŸ’¡ ã‚‚ã†ä¸€åº¦ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„');
                            break;
                        case 'auth/cancelled-popup-request':
                            log('ğŸ’¡ å‰å›ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸ');
                            log('ğŸ’¡ ã—ã°ã‚‰ãå¾…ã£ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„');
                            break;
                        default:
                            if (error.message === 'POPUP_TIMEOUT') {
                                log('âš ï¸ ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒé€”ä¸­ã§æ­¢ã¾ã‚Šã¾ã—ãŸ');
                                showPopupGuide(isMobile);
                            } else {
                                log('ğŸ’¡ ãƒ–ãƒ©ã‚¦ã‚¶ã‚’æ›´æ–°ã—ã¦ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„');
                            }
                    }
                } else if (error.message === 'POPUP_TIMEOUT') {
                    showPopupGuide(isMobile);
                }
                
                if (error.credential) {
                    log('- èªè¨¼æƒ…å ±ã¯å–å¾—æ¸ˆã¿');
                }
            }
        };

        // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¨±å¯ã‚¬ã‚¤ãƒ‰è¡¨ç¤º
        function showPopupGuide(isMobile) {
            log('ğŸ“– === ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¨±å¯ã‚¬ã‚¤ãƒ‰ ===');
            if (isMobile) {
                log('ğŸ“± ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³å‘ã‘è§£æ±ºæ‰‹é †:');
                log('1. ãƒšãƒ¼ã‚¸ä¸Šéƒ¨ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼ã«è¡¨ç¤ºã•ã‚Œã‚‹ã€Œãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸã€ã‚’ã‚¿ãƒƒãƒ—');
                log('2. ã¾ãŸã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¡ãƒ‹ãƒ¥ãƒ¼(â‹®) â†’ è¨­å®š â†’ ã‚µã‚¤ãƒˆè¨­å®š â†’ ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã¨ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ â†’ è¨±å¯');
                log('3. Chrome: å³ä¸Šâ‹®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ â†’ è¨­å®š â†’ è©³ç´°è¨­å®š â†’ ã‚µã‚¤ãƒˆè¨­å®š â†’ ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã¨ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ');
                log('4. Safari: è¨­å®šã‚¢ãƒ—ãƒª â†’ Safari â†’ ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒ–ãƒ­ãƒƒã‚¯ â†’ ã‚ªãƒ•');
                log('5. è¨­å®šå¾Œã€ã“ã®ãƒšãƒ¼ã‚¸ã‚’æ›´æ–°ã—ã¦ã‚‚ã†ä¸€åº¦ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„');
            } else {
                log('ğŸ’» PCå‘ã‘è§£æ±ºæ‰‹é †:');
                log('1. ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼å³ç«¯ã®ã‚¢ã‚¤ã‚³ãƒ³(ğŸš«)ã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ è¨±å¯');
                log('2. ã¾ãŸã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶è¨­å®š â†’ ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ â†’ ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã¨ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ â†’ è¨±å¯');
            }
            log('ğŸ’¡ ãã‚Œã§ã‚‚è§£æ±ºã—ãªã„å ´åˆ: ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ‰ã‚’çµ‚äº†ã™ã‚‹ã‹ã€åˆ¥ã®ãƒ–ãƒ©ã‚¦ã‚¶ã‚’ãŠè©¦ã—ãã ã•ã„');
            log('ğŸ”„ ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¨­å®šã‚’ç¢ºèªã—ãŸã‚‰ã€å†åº¦ã€ŒGoogleã§ãƒ­ã‚°ã‚¤ãƒ³ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„');
            log('ğŸ“– ========================');
        }

        // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒ†ã‚¹ãƒˆæ©Ÿèƒ½
        window.testPopup = () => {
            log('ğŸ§ª ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒ†ã‚¹ãƒˆé–‹å§‹...');
            
            try {
                const testWindow = window.open('', '_blank', 'width=400,height=500');
                
                if (testWindow) {
                    log('âœ… ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¨±å¯æ¸ˆã¿ - ãƒ­ã‚°ã‚¤ãƒ³å¯èƒ½ã§ã™');
                    testWindow.close();
                    log('ğŸ’¡ ã€ŒGoogleã§ãƒ­ã‚°ã‚¤ãƒ³ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„');
                } else {
                    log('âŒ ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã¾ã™');
                    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                    showPopupGuide(isMobile);
                }
            } catch (error) {
                log(`âŒ ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                showPopupGuide(isMobile);
            }
        };

        // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
        window.handleLogout = async () => {
            try {
                await auth.signOut();
                // loadCustomItemså®Ÿè¡Œãƒ•ãƒ©ã‚°ã‚’ãƒªã‚»ãƒƒãƒˆï¼ˆæ¬¡å›ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã«å†å®Ÿè¡Œå¯èƒ½ã«ã™ã‚‹ï¼‰
                isLoadCustomItemsExecuted = false;
                log('ğŸ“¤ ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå®Œäº† (ã‚«ã‚¹ã‚¿ãƒ é …ç›®ãƒ•ãƒ©ã‚°ãƒªã‚»ãƒƒãƒˆæ¸ˆã¿)');
            } catch (error) {
                log(`âŒ ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        };

        // ãƒ‡ãƒ¼ã‚¿ä¿å­˜
        window.saveWeightData = async () => {
            if (!currentUser) {
                log('âŒ ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™');
                return;
            }

            const date = document.getElementById('dateInput').value;
            const weight = document.getElementById('weightValue').value;
            const memo = document.getElementById('memoInput').value;

            if (!date || !weight) {
                log('âŒ æ—¥ä»˜ã¨å€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            try {
                log('ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ä¸­...');
                
                const now = new Date();
                const timeString = now.toLocaleTimeString('ja-JP', { 
                    hour12: false, 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                
                const weightData = {
                    date: date,
                    time: timeString,
                    value: parseFloat(weight),
                    timing: selectedTimingValue || '',
                    clothing: {
                        top: selectedTopValue || '',
                        bottom: selectedBottomValue || ''
                    },
                    memo: memo || '',
                    userEmail: currentUser.email,
                    timestamp: firebase.database.ServerValue.TIMESTAMP,
                    createdAt: now.toISOString()
                };

                if (window.editingEntryId) {
                    // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰: æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°
                    const entryRef = database.ref(`users/${currentUser.uid}/weights/${window.editingEntryId}`);
                    await entryRef.update({
                        date: date,
                        time: timeString,
                        weight: parseFloat(weight),
                        timing: selectedTimingValue || '',
                        clothing: {
                            top: selectedTopValue || '',
                            bottom: selectedBottomValue || ''
                        },
                        memo: memo || '',
                        userEmail: currentUser.email,
                        updatedAt: firebase.database.ServerValue.TIMESTAMP
                    });
                } else {
                    // æ–°è¦ä¿å­˜ãƒ¢ãƒ¼ãƒ‰
                    const userRef = database.ref(`users/${currentUser.uid}/weights`);
                    await userRef.push(weightData);
                }
                
                // ä¿å­˜å®Œäº†ãƒ­ã‚°ï¼ˆæœè£…æƒ…å ±ã‚‚å«ã‚€ï¼‰
                let logMessage;
                if (window.editingEntryId) {
                    logMessage = `âœï¸ æ›´æ–°å®Œäº†: ${date} ${timeString} - ${weight}kg`;
                } else {
                    logMessage = `âœ… ä¿å­˜å®Œäº†: ${date} ${timeString} - ${weight}kg`;
                }
                if (selectedTimingValue) logMessage += ` (${selectedTimingValue})`;
                if (selectedTopValue || selectedBottomValue) {
                    const clothingInfo = [selectedTopValue, selectedBottomValue].filter(Boolean).join(', ');
                    logMessage += ` [${clothingInfo}]`;
                }
                log(logMessage);
                
                // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ã‚¯ãƒªã‚¢ï¼ˆä½“é‡ã¯72.0ã«æˆ»ã™ï¼‰
                document.getElementById('weightValue').value = '72.0';
                document.getElementById('memoInput').value = '';
                document.getElementById('selectedTop').value = '';
                document.getElementById('selectedBottom').value = '';
                selectedTimingValue = '';
                selectedTopValue = '';
                selectedBottomValue = '';
                
                // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã‚’ãƒªã‚»ãƒƒãƒˆ
                window.editingEntryId = null;
                document.querySelector('.save-button').textContent = 'ğŸ’¾ ä¿å­˜';
                document.querySelector('.save-button').style.background = '#28a745';
                
                // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’å‰Šé™¤
                const editModeIndicator = document.getElementById('editModeIndicator');
                if (editModeIndicator) {
                    editModeIndicator.remove();
                }
                
                // ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒœã‚¿ãƒ³ã‚’å‰Šé™¤
                const cancelButton = document.getElementById('cancelEditButton');
                if (cancelButton) {
                    cancelButton.remove();
                }
                
                // ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ãƒªã‚»ãƒƒãƒˆ
                document.querySelectorAll('.timing-btn').forEach(btn => {
                    btn.style.opacity = '0.7';
                    btn.classList.remove('selected');
                });
                document.querySelectorAll('.clothing-btn').forEach(btn => {
                    btn.style.opacity = '0.7';
                    btn.style.transform = 'scale(1)';
                });
                
                // ãƒ‡ãƒ¼ã‚¿ã‚’å†èª­ã¿è¾¼ã¿
                loadUserWeightData(currentUser.uid);
            } catch (error) {
                log(`âŒ ä¿å­˜ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        };

        // ä½“é‡ãƒ‡ãƒ¼ã‚¿ç·¨é›†æ©Ÿèƒ½
        window.editWeightEntry = async (entryId) => {
            if (!currentUser) {
                log('âŒ ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™');
                return;
            }
            
            try {
                const entryRef = database.ref(`users/${currentUser.uid}/weights/${entryId}`);
                const snapshot = await entryRef.once('value');
                const entry = snapshot.val();
                
                if (!entry) {
                    log('âŒ è¨˜éŒ²ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return;
                }
                
                // ãƒ•ã‚©ãƒ¼ãƒ ã«ãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®š
                document.getElementById('dateInput').value = entry.date;
                document.getElementById('weightValue').value = entry.value || entry.weight;
                document.getElementById('memoInput').value = entry.memo || '';
                
                // ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’è¨­å®š
                if (entry.timing) {
                    selectTiming(entry.timing);
                }
                
                // æœè£…ã‚’è¨­å®š
                if (entry.clothing && entry.clothing.top) {
                    selectClothingTop(entry.clothing.top);
                }
                if (entry.clothing && entry.clothing.bottom) {
                    selectClothingBottom(entry.clothing.bottom);
                }
                
                
                // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ
                window.editingEntryId = entryId;
                document.querySelector('.save-button').textContent = 'âœï¸ æ›´æ–°';
                document.querySelector('.save-button').style.background = '#ffc107';
                
                // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã§ã‚ã‚‹ã“ã¨ã‚’æ˜ç¢ºã«è¡¨ç¤º
                const editModeIndicator = document.getElementById('editModeIndicator');
                if (editModeIndicator) {
                    editModeIndicator.remove();
                }
                const indicator = document.createElement('div');
                indicator.id = 'editModeIndicator';
                indicator.innerHTML = 'âœï¸ <strong>ç·¨é›†ãƒ¢ãƒ¼ãƒ‰</strong> - ' + entry.date + ' ' + (entry.value || entry.weight) + 'kgã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿®æ­£ã—ã¦æ›´æ–°ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„';
                indicator.style.cssText = 'background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; padding: 10px; border-radius: 5px; margin-bottom: 15px; text-align: center; animation: fadeIn 0.3s;';
                document.querySelector('.save-button').parentNode.insertBefore(indicator, document.querySelector('.save-button'));
                
                // ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒœã‚¿ãƒ³ã‚’è¿½åŠ 
                const existingCancelButton = document.getElementById('cancelEditButton');
                if (existingCancelButton) {
                    existingCancelButton.remove();
                }
                const cancelButton = document.createElement('button');
                cancelButton.id = 'cancelEditButton';
                cancelButton.innerHTML = 'âŒ ã‚­ãƒ£ãƒ³ã‚»ãƒ«';
                cancelButton.onclick = cancelEdit;
                cancelButton.style.cssText = 'background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 16px; font-weight: bold; margin-left: 10px;';
                document.querySelector('.save-button').parentNode.insertBefore(cancelButton, document.querySelector('.save-button').nextSibling);
                
                log(`âœï¸ ç·¨é›†ãƒ¢ãƒ¼ãƒ‰: ${entry.date} ${entry.value || entry.weight} ã®ãƒ‡ãƒ¼ã‚¿ã‚’ç·¨é›†ä¸­`);
                
                // ãƒšãƒ¼ã‚¸ãƒˆãƒƒãƒ—ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
                window.scrollTo(0, 0);
                
            } catch (error) {
                log(`âŒ ç·¨é›†ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        };
        
        // ç·¨é›†ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ©Ÿèƒ½
        window.cancelEdit = () => {
            // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢
            document.getElementById('dateInput').value = '';
            document.getElementById('weightValue').value = '';
            document.getElementById('memoInput').value = '';
            
            // é¸æŠçŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            selectedTimingValue = '';
            selectedTopValue = '';
            selectedBottomValue = '';
            
            // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã‚’ãƒªã‚»ãƒƒãƒˆ
            window.editingEntryId = null;
            document.querySelector('.save-button').textContent = 'ğŸ’¾ ä¿å­˜';
            document.querySelector('.save-button').style.background = '#28a745';
            
            // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’å‰Šé™¤
            const editModeIndicator = document.getElementById('editModeIndicator');
            if (editModeIndicator) {
                editModeIndicator.remove();
            }
            
            // ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒœã‚¿ãƒ³ã‚’å‰Šé™¤
            const cancelButton = document.getElementById('cancelEditButton');
            if (cancelButton) {
                cancelButton.remove();
            }
            
            // ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.querySelectorAll('.timing-btn').forEach(btn => {
                btn.style.opacity = '0.7';
                btn.classList.remove('selected');
            });
            document.querySelectorAll('.clothing-btn').forEach(btn => {
                btn.style.opacity = '0.7';
                btn.style.transform = 'scale(1)';
            });
            
            log('âŒ ç·¨é›†ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸ');
        };
        
        // ãƒ‡ãƒ¼ã‚¿å‰Šé™¤
        window.deleteWeightEntry = async (entryId) => {
            if (!currentUser) {
                log('âŒ ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™');
                return;
            }
            
            if (!confirm('ã“ã®è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                return;
            }
            
            try {
                log(`ğŸ—‘ï¸ ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ä¸­: ${entryId}`);
                const entryRef = database.ref(`users/${currentUser.uid}/weights/${entryId}`);
                await entryRef.remove();
                log(`âœ… å‰Šé™¤å®Œäº†: ${entryId}`);
            } catch (error) {
                log(`âŒ å‰Šé™¤ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        };

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
        // loadUserWeightDataé–¢æ•°ã¯ tabs/tab1-weight/tab-weight.js ã«ç§»å‹•æ¸ˆã¿

        // ã‚°ãƒ©ãƒ•ã‚’æ›´æ–°










        // ç¾åœ¨ã®ã‚¿ãƒ–
        let currentTab = 1;
        
        // ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å‹•çš„èª­ã¿è¾¼ã¿
        window.loadTabContent = async (tabNumber, tabType) => {
            try {
                const tabContentDiv = document.getElementById(`tabContent${tabNumber}`);
                if (!tabContentDiv) return;
                
                // HTMLã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’èª­ã¿è¾¼ã¿
                const response = await fetch(`tabs/tab${tabNumber}-${tabType}/tab-${tabType}.html`);
                if (response.ok) {
                    const htmlContent = await response.text();
                    tabContentDiv.innerHTML = htmlContent;
                    
                    // JavaScriptãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‹•çš„èª­ã¿è¾¼ã¿
                    await loadTabScript(tabNumber, tabType);
                    
                    // ã‚¿ãƒ–å›ºæœ‰ã®åˆæœŸåŒ–å‡¦ç†ï¼ˆJSãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿å®Œäº†å¾Œï¼‰
                    if (tabNumber === 1 && currentUser) {
                        log(`ğŸ”„ tab1: ä½“é‡ç®¡ç†ã‚¿ãƒ–åˆæœŸåŒ–å®Ÿè¡Œ`);
                        
                        // å¤–éƒ¨JSãƒ•ã‚¡ã‚¤ãƒ«ã®åˆæœŸåŒ–é–¢æ•°ã‚’å‘¼ã³å‡ºã—
                        setTimeout(() => {
                            if (typeof window.initWeightTab === 'function') {
                                window.initWeightTab();
                                log('âœ… ä½“é‡ç®¡ç†ã‚¿ãƒ–åˆæœŸåŒ–å®Œäº†');
                            } else {
                                log('âŒ initWeightTabé–¢æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                            }
                        }, 200);
                    } else if (tabNumber === 3 && currentUser) {
                        log('ğŸ”„ éƒ¨å±‹ç‰‡ä»˜ã‘ã‚¿ãƒ–: JSèª­ã¿è¾¼ã¿å®Œäº†å¾Œã®ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿é–‹å§‹');
                        setTimeout(() => {
                            if (typeof window.loadRoomData === 'function') {
                                window.loadRoomData();
                                log('âœ… éƒ¨å±‹ç‰‡ä»˜ã‘ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Ÿè¡Œ');
                            } else if (typeof loadRoomData === 'function') {
                                loadRoomData();
                                log('âœ… éƒ¨å±‹ç‰‡ä»˜ã‘ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Ÿè¡Œï¼ˆãƒ­ãƒ¼ã‚«ãƒ«é–¢æ•°ï¼‰');
                            } else {
                                log('âŒ loadRoomDataé–¢æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                            }
                        }, 200); // å°‘ã—é•·ã‚ã®å¾…æ©Ÿæ™‚é–“
                    } else if (tabNumber === 8 && currentUser) {
                        log('ğŸ”„ ãƒ¡ãƒ¢ãƒªã‚¹ãƒˆã‚¿ãƒ–: JSèª­ã¿è¾¼ã¿å®Œäº†å¾Œã®ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿é–‹å§‹');
                        setTimeout(() => {
                            loadMemoData();
                        }, 100);
                    }
                    
                    log(`âœ… ã‚¿ãƒ–${tabNumber}ï¼ˆ${tabType}ï¼‰ã‚³ãƒ³ãƒ†ãƒ³ãƒ„èª­ã¿è¾¼ã¿å®Œäº†`);
                } else {
                    log(`âš ï¸ ã‚¿ãƒ–${tabNumber}ã®åˆ†é›¢ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ - æ—¢å­˜ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ä½¿ç”¨`);
                }
            } catch (error) {
                log(`âŒ ã‚¿ãƒ–èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        };
        
        // ã‚¿ãƒ–ç”¨JavaScriptã®å‹•çš„èª­ã¿è¾¼ã¿
        window.loadTabScript = async (tabNumber, tabType) => {
            try {
                // æ—¢å­˜ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¿ã‚°ã‚’å‰Šé™¤
                const existingScript = document.getElementById(`tab${tabNumber}Script`);
                if (existingScript) {
                    existingScript.remove();
                }
                
                // æ–°ã—ã„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¿ã‚°ã‚’ä½œæˆ
                const script = document.createElement('script');
                script.id = `tab${tabNumber}Script`;
                script.src = `tabs/tab${tabNumber}-${tabType}/tab-${tabType}.js`;
                document.head.appendChild(script);
                
                return new Promise((resolve, reject) => {
                    script.onload = () => resolve();
                    script.onerror = () => reject(new Error(`Script load failed: ${script.src}`));
                });
            } catch (error) {
                throw error;
            }
        };

        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½ï¼ˆå‹•çš„èª­ã¿è¾¼ã¿å¯¾å¿œï¼‰
        window.switchTab = async (tabNumber) => {
            currentTab = tabNumber;
            
            // ç¾åœ¨ã®ã‚¿ãƒ–ã‚’ localStorage ã«ä¿å­˜
            localStorage.setItem('currentTab', tabNumber);
            
            // ã™ã¹ã¦ã®ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ï¼ˆ16ã‚¿ãƒ–å¯¾å¿œï¼‰
            for (let i = 1; i <= 16; i++) {
                const tabBtn = document.getElementById(`tab${i}`);
                const tabContent = document.getElementById(`tabContent${i}`);
                
                log(`ğŸ” ã‚¿ãƒ–${i}: ãƒœã‚¿ãƒ³=${tabBtn ? 'å­˜åœ¨' : 'ãªã—'}, ã‚³ãƒ³ãƒ†ãƒ³ãƒ„=${tabContent ? 'å­˜åœ¨' : 'ãªã—'}`);
                
                if (i === tabNumber) {
                    // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¿ãƒ–
                    if (tabBtn) {
                        tabBtn.style.background = '#007bff';
                        tabBtn.style.color = 'white';
                    }
                    if (tabContent) {
                        tabContent.classList.remove('hidden');
                        log(`âœ… ã‚¿ãƒ–${i}ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¡¨ç¤º`);
                    }
                    
                    // å‹•çš„èª­ã¿è¾¼ã¿ï¼ˆå…¨åˆ†é›¢ã‚¿ãƒ–çµ±ä¸€ï¼‰
                    if (i === 1) {
                        await loadTabContent(1, 'weight');
                    } else if (i === 2) {
                        await loadTabContent(2, 'sleep');
                    } else if (i === 3) {
                        await loadTabContent(3, 'room-cleaning');
                    } else if (i === 8) {
                        await loadTabContent(8, 'memo-list');
                    }
                } else {
                    // éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¿ãƒ–
                    if (tabBtn) {
                        tabBtn.style.background = '#f8f9fa';
                        tabBtn.style.color = '#495057';
                    }
                    if (tabContent) {
                        tabContent.classList.add('hidden');
                        log(`âŒ ã‚¿ãƒ–${i}ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’éè¡¨ç¤º`);
                    }
                }
            }
            
            // ã‚¿ã‚¤ãƒˆãƒ«æ›´æ–°
            const tabTitles = {
                1: 'ğŸ“Š ä½“é‡ç®¡ç†ã‚¢ãƒ—ãƒª',
                2: 'ğŸ›ï¸ ç¡çœ ç®¡ç†',
                3: 'ğŸ  éƒ¨å±‹ç‰‡ã¥ã‘',
                4: 'ğŸ¤¸ ã‚¹ãƒˆãƒ¬ãƒƒãƒ',
                5: 'ğŸ”§ xx5',
                6: 'ğŸ”§ xx6', 
                7: 'ğŸ”§ xx7',
                8: 'ğŸ“ ãƒ¡ãƒ¢ãƒªã‚¹ãƒˆ'
            };
            
            const titleElement = document.getElementById('appTitle');
            if (titleElement && tabTitles[tabNumber]) {
                titleElement.textContent = `${tabTitles[tabNumber]} ${APP_VERSION}`;
            }
            
            // ä½“é‡ç®¡ç†è¦ç´ ã¯å¸¸ã«è¡¨ç¤ºï¼ˆtabContent1å†…ã«ã‚ã‚‹ãŸã‚è‡ªå‹•åˆ¶å¾¡ã•ã‚Œã‚‹ï¼‰
            
            // ã‚¿ãƒ–å›ºæœ‰ã®åˆæœŸåŒ–å‡¦ç†
            if (tabNumber === 1) {
                // ä½“é‡ç®¡ç†ã‚¿ãƒ–ã®åˆæœŸåŒ–ï¼ˆå¤–éƒ¨JSã§å‡¦ç†ï¼‰
                if (currentUser && typeof window.initWeightTab === 'function') {
                    log('ğŸ”„ ä½“é‡ç®¡ç†ã‚¿ãƒ–: å¤–éƒ¨JSåˆæœŸåŒ–å®Ÿè¡Œ');
                    window.initWeightTab();
                }
            } else if (tabNumber === 2) {
                // ç¡çœ ç®¡ç†ã‚¿ãƒ–ã®åˆæœŸåŒ–ï¼ˆãƒ­ã‚°ã‚¤ãƒ³ã«é–¢ä¿‚ãªãå®Ÿè¡Œï¼‰
                initializeSleepManager();
                if (currentUser) {
                    loadSleepData();
                }
            } else if (tabNumber === 3) {
                // éƒ¨å±‹ç‰‡ä»˜ã‘ã‚¿ãƒ–ã®åˆæœŸåŒ–ï¼ˆãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã¯loadTabContentå®Œäº†å¾Œã«å®Ÿè¡Œï¼‰
                log('ğŸ”„ éƒ¨å±‹ç‰‡ä»˜ã‘ã‚¿ãƒ–ã«åˆ‡ã‚Šæ›¿ãˆ - åˆæœŸåŒ–ã®ã¿å®Ÿè¡Œ');
                initRoomManagement();
            } else if (tabNumber === 8) {
                // ãƒ¡ãƒ¢ãƒªã‚¹ãƒˆã‚¿ãƒ–ã®åˆæœŸåŒ–ï¼ˆãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã¯loadTabContentå®Œäº†å¾Œã«å®Ÿè¡Œï¼‰
                log('ğŸ”„ ãƒ¡ãƒ¢ãƒªã‚¹ãƒˆã‚¿ãƒ–ã«åˆ‡ã‚Šæ›¿ãˆ - åˆæœŸåŒ–ã®ã¿å®Ÿè¡Œ');
            }
            
            log(`ğŸ“‘ ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ: ã‚¿ãƒ–${tabNumber}`);
        };

        // UIè¡¨ç¤ºåˆ¶å¾¡
        function showUserInterface(user) {
            document.getElementById('authSection').classList.add('hidden');
            document.getElementById('userInfo').classList.remove('hidden');
            document.getElementById('tabNavigation').classList.remove('hidden');
            document.getElementById('appHeader').classList.remove('hidden');
            // ä½“é‡ç®¡ç†é–¢é€£è¦ç´ ã¯å­˜åœ¨ãƒã‚§ãƒƒã‚¯å¾Œã«è¡¨ç¤º
            const modeControl = document.getElementById('modeControl');
            if (modeControl) modeControl.classList.remove('hidden');
            
            const weightInput = document.getElementById('weightInput');
            if (weightInput) weightInput.classList.remove('hidden');
            
            const chartPanel = document.getElementById('chartPanel');
            if (chartPanel) chartPanel.classList.remove('hidden');
            
            const weightHistoryPanel = document.getElementById('weightHistoryPanel');
            if (weightHistoryPanel) weightHistoryPanel.classList.remove('hidden');
            document.getElementById('userName').textContent = user.displayName;
            
            // ä¿å­˜ã•ã‚ŒãŸã‚¿ãƒ–ã¾ãŸã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã‚¿ãƒ–1ã‚’è¡¨ç¤º
            const savedTab = localStorage.getItem('currentTab');
            const tabToShow = savedTab ? parseInt(savedTab) : 1;
            switchTab(tabToShow);
            
            // ä»Šæ—¥ã®æ—¥ä»˜ã¨ä½“é‡ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®šï¼ˆã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³è€ƒæ…®ï¼‰
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            const todayString = `${year}-${month}-${day}`;
            document.getElementById('dateInput').value = todayString;
            document.getElementById('weightValue').value = '72.0';
            
            // ãƒ¡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ï¼ˆãƒ­ã‚°ã‚¤ãƒ³æ™‚ã€å­˜åœ¨ãƒã‚§ãƒƒã‚¯ä»˜ãï¼‰
            if (typeof loadMemoData === 'function') {
                loadMemoData();
                log('âœ… ãƒ¡ãƒ¢ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Ÿè¡Œ');
            } else {
                log('âš ï¸ loadMemoDataé–¢æ•°æœªå®šç¾© - åˆæœŸåŒ–æ™‚ã‚¹ã‚­ãƒƒãƒ—');
            }
            
            // ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãƒœã‚¿ãƒ³ã®åˆæœŸçŠ¶æ…‹è¨­å®š
            document.querySelectorAll('.timing-btn').forEach(btn => {
                btn.style.opacity = '0.7';
                btn.classList.remove('selected');
            });
            
            // æœè£…ãƒœã‚¿ãƒ³ã®åˆæœŸçŠ¶æ…‹è¨­å®š
            document.querySelectorAll('.clothing-btn').forEach(btn => {
                btn.style.opacity = '0.7';
                btn.style.transform = 'scale(1)';
            });
            
            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæœè£…é¸æŠ: ä¸Š=ãªã—, ä¸‹=ãƒˆãƒ©ãƒ³ã‚¯ã‚¹
            selectClothingTop('ãªã—');
            selectClothingBottom('ãƒˆãƒ©ãƒ³ã‚¯ã‚¹');
            
        }

        function showLoginInterface() {
            document.getElementById('authSection').classList.remove('hidden');
            document.getElementById('userInfo').classList.add('hidden');
            document.getElementById('tabNavigation').classList.add('hidden');
            document.getElementById('appHeader').classList.add('hidden');
            document.getElementById('modeControl').classList.add('hidden');
            document.getElementById('weightInput').classList.add('hidden');
            document.getElementById('chartPanel').classList.add('hidden');
        }

        // ãƒ­ã‚°å‡ºåŠ›é–¢æ•°ï¼ˆå®‰å…¨ã‚¢ã‚¯ã‚»ã‚¹å¯¾å¿œï¼‰
        function log(message) {
            const logArea = document.getElementById('logArea');
            const timestamp = new Date().toLocaleTimeString();
            
            // DOMè¦ç´ ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã®ã¿
            if (logArea) {
                logArea.innerHTML += `[${timestamp}] ${message}<br>`;
                logArea.scrollTop = logArea.scrollHeight;
            }
            console.log(`[${timestamp}] ${message}`);
        }

        // ãƒ­ã‚°ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½ï¼ˆå®‰å…¨ã‚¢ã‚¯ã‚»ã‚¹å¯¾å¿œï¼‰
        window.copyLogs = () => {
            const logArea = document.getElementById('logArea');
            if (!logArea) {
                console.log('âš ï¸ logAreaè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return;
            }
            const logText = logArea.innerText || logArea.textContent;
            navigator.clipboard.writeText(logText).then(() => {
                alert('âœ… ãƒ­ã‚°ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
            }).catch(() => {
                // fallback
                const textArea = document.createElement('textarea');
                textArea.value = logText;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('âœ… ãƒ­ã‚°ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
            });
        };

        // Firebaseæ¥ç¶šãƒ‡ãƒãƒƒã‚°
        window.debugFirebaseConnection = () => {
            log('ğŸ” === Firebase Debug é–‹å§‹ ===');
            
            // 1. Firebaseè¨­å®šç¢ºèª
            log(`ğŸ”¥ Firebase Configç¢ºèª:`);
            log(`- Project ID: ${firebaseConfig.projectId}`);
            log(`- Database URL: ${firebaseConfig.databaseURL}`);
            log(`- Auth Domain: ${firebaseConfig.authDomain}`);
            
            // 2. èªè¨¼çŠ¶æ…‹ç¢ºèª
            if (currentUser) {
                log(`âœ… èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼:`);
                log(`- UID: ${currentUser.uid.substring(0,8)}...`);
                log(`- Email: ${currentUser.email}`);
                log(`- è¡¨ç¤ºå: ${currentUser.displayName}`);
            } else {
                log('âŒ æœªèªè¨¼çŠ¶æ…‹');
            }
            
            // 3. æ¥ç¶šãƒ†ã‚¹ãƒˆ
            const connectedRef = database.ref('.info/connected');
            connectedRef.once('value', (snapshot) => {
                const connected = snapshot.val();
                log(`ğŸŒ Firebaseæ¥ç¶šçŠ¶æ…‹: ${connected ? 'æ¥ç¶šä¸­' : 'æœªæ¥ç¶š'}`);
                
                if (connected && currentUser) {
                    // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ
                    const testRef = database.ref(`users/${currentUser.uid}/test`);
                    testRef.set({
                        timestamp: firebase.database.ServerValue.TIMESTAMP,
                        message: 'Connection test',
                        app: 'app-template'
                    }).then(() => {
                        log('âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ›¸ãè¾¼ã¿ãƒ†ã‚¹ãƒˆæˆåŠŸ');
                    }).catch((error) => {
                        log(`âŒ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ›¸ãè¾¼ã¿ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                        log(`- Error Code: ${error.code}`);
                    });
                }
            });
            
            log('ğŸ” === Firebase Debug å®Œäº† ===');
        };

        // ãƒ¢ãƒã‚¤ãƒ«ç’°å¢ƒè¨ºæ–­
        window.checkMobileSupport = () => {
            log('ğŸ“± === ãƒ¢ãƒã‚¤ãƒ«ç’°å¢ƒè¨ºæ–­ é–‹å§‹ ===');
            
            const userAgent = navigator.userAgent;
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);
            
            log(`ğŸŒ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ: ${userAgent}`);
            log(`ğŸ“± ãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒã‚¤ã‚¹åˆ¤å®š: ${isMobile ? 'ãƒ¢ãƒã‚¤ãƒ«' : 'ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—'}`);
            
            // ãƒ–ãƒ©ã‚¦ã‚¶åˆ¤å®š
            const isChrome = /Chrome/i.test(userAgent);
            const isSafari = /Safari/i.test(userAgent) && !/Chrome/i.test(userAgent);
            const isFirefox = /Firefox/i.test(userAgent);
            
            log(`ğŸŒ ãƒ–ãƒ©ã‚¦ã‚¶: ${isChrome ? 'Chrome' : isSafari ? 'Safari' : isFirefox ? 'Firefox' : 'ä¸æ˜'}`);
            
            // ãƒ­ã‚°ã‚¤ãƒ³æ–¹å¼ã®æ¨å¥¨
            if (isMobile) {
                log('ğŸ’¡ ãƒ¢ãƒã‚¤ãƒ«ã®æ¨å¥¨è¨­å®š:');
                log('- Googleãƒ­ã‚°ã‚¤ãƒ³ã¯ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆæ–¹å¼ã‚’ä½¿ç”¨');
                log('- ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒ–ãƒ­ãƒƒã‚«ãƒ¼ã®å½±éŸ¿ãªã—');
                log('- èªè¨¼å¾Œã«ãƒšãƒ¼ã‚¸ãŒå†èª­ã¿è¾¼ã¿ã•ã‚Œã¾ã™');
            }
            
            log('ğŸ“± === ãƒ¢ãƒã‚¤ãƒ«ç’°å¢ƒè¨ºæ–­ å®Œäº† ===');
        };

        // Firebaseè¨­å®šè¨ºæ–­
        window.checkFirebaseConfig = () => {
            log('ğŸ”§ === Firebaseè¨­å®šè¨ºæ–­ é–‹å§‹ ===');
            
            // ç¾åœ¨ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ç¢ºèª
            const currentDomain = window.location.hostname;
            const currentUrl = window.location.href;
            log(`ğŸŒ ç¾åœ¨ã®ãƒ‰ãƒ¡ã‚¤ãƒ³: ${currentDomain}`);
            log(`ğŸ”— ç¾åœ¨ã®URL: ${currentUrl}`);
            
            // Firebaseè¨­å®šæƒ…å ±
            log(`ğŸ”¥ Firebaseè¨­å®š:`);
            log(`- Project ID: ${firebaseConfig.projectId}`);
            log(`- Auth Domain: ${firebaseConfig.authDomain}`);
            log(`- Database URL: ${firebaseConfig.databaseURL}`);
            
            // èªè¨¼ãƒ‰ãƒ¡ã‚¤ãƒ³è¨±å¯çŠ¶æ³ã®æ¨æ¸¬
            if (currentDomain === 'muumuu8181.github.io') {
                log('âœ… GitHub Pagesãƒ‰ãƒ¡ã‚¤ãƒ³æ¤œå‡º');
                log('ğŸ’¡ Firebase Consoleã§ã“ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ãŒè¨±å¯ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªãŒå¿…è¦');
            } else if (currentDomain === 'localhost' || currentDomain === '127.0.0.1') {
                log('âœ… ãƒ­ãƒ¼ã‚«ãƒ«ãƒ›ã‚¹ãƒˆæ¤œå‡º');
                log('ğŸ’¡ é€šå¸¸ã¯è‡ªå‹•ã§è¨±å¯ã•ã‚Œã¦ã„ã¾ã™');
            } else {
                log('âš ï¸ ä¸æ˜ãªãƒ‰ãƒ¡ã‚¤ãƒ³ã§ã™');
                log('ğŸ’¡ Firebase Consoleã®èªè¨¼è¨­å®šã§è¨±å¯ãŒå¿…è¦ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“');
            }
            
            // ãƒ¢ãƒã‚¤ãƒ«ãƒ–ãƒ©ã‚¦ã‚¶ã§ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆåˆ¶é™ç¢ºèª
            const userAgent = navigator.userAgent;
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);
            
            if (isMobile) {
                log('ğŸ“± ãƒ¢ãƒã‚¤ãƒ«ãƒ–ãƒ©ã‚¦ã‚¶å›ºæœ‰ã®åˆ¶é™:');
                log('- Safari: ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£Cookieã®åˆ¶é™ã‚ã‚Š');
                log('- Chrome Mobile: ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®è‡ªå‹•ãƒ–ãƒ­ãƒƒã‚¯');
                log('- è§£æ±ºç­–: ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆæ–¹å¼ã¾ãŸã¯ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¨±å¯è¨­å®š');
            }
            
            log('ğŸ”§ === Firebaseè¨­å®šè¨ºæ–­ å®Œäº† ===');
        };

        // èªè¨¼çŠ¶æ…‹ã®å¼·åˆ¶ç¢ºèª
        window.forceAuthCheck = () => {
            log('ğŸ” === èªè¨¼çŠ¶æ…‹å¼·åˆ¶ç¢ºèª é–‹å§‹ ===');
            
            const user = auth.currentUser;
            log(`ğŸ” Firebaseèªè¨¼çŠ¶æ…‹: ${user ? `ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ (${user.displayName})` : 'æœªãƒ­ã‚°ã‚¤ãƒ³'}`);
            
            if (user) {
                log('âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ç”»é¢ã‚’è¡¨ç¤ºã—ã¾ã™');
                showUserInterface(user);
                loadUserWeightData(user.uid);
            } else {
                log('âŒ ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã‚’è¡¨ç¤ºã—ã¾ã™');
                showLoginInterface();
            }
            
            // èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã®æœ‰åŠ¹æ€§ç¢ºèª
            if (user) {
                user.getIdToken(true).then(() => {
                    log('âœ… èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã¯æœ‰åŠ¹ã§ã™');
                }).catch((tokenError) => {
                    log(`âŒ èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚¨ãƒ©ãƒ¼: ${tokenError.message}`);
                    log('ğŸ’¡ å†ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“');
                });
            }
            
            log('ğŸ” === èªè¨¼çŠ¶æ…‹å¼·åˆ¶ç¢ºèª å®Œäº† ===');
        };

        // ãƒ­ã‚°ã‚¤ãƒ³å•é¡Œè¨ºæ–­
        window.checkLoginIssues = () => {
            log('âš ï¸ === ãƒ­ã‚°ã‚¤ãƒ³å•é¡Œè¨ºæ–­ é–‹å§‹ ===');
            
            // 1. ãƒ—ãƒ­ãƒˆã‚³ãƒ«ãƒã‚§ãƒƒã‚¯
            const protocol = window.location.protocol;
            log(`ğŸŒ ç¾åœ¨ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«: ${protocol}`);
            
            if (protocol === 'file:') {
                log('âŒ å•é¡Œç™ºè¦‹: file://ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ã¯Googleèªè¨¼ãŒå‹•ä½œã—ã¾ã›ã‚“');
                log('âœ… è§£æ±ºæ–¹æ³•:');
                log('  1. HTTPã‚µãƒ¼ãƒãƒ¼çµŒç”±ã§ã‚¢ã‚¯ã‚»ã‚¹');
                log('  2. chrome://flags ã§ insecure origins ã‚’è¨±å¯');
                log('  3. ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼èµ·å‹• (python -m http.server 8000)');
            } else if (protocol === 'https:' || protocol === 'http:') {
                log('âœ… ãƒ—ãƒ­ãƒˆã‚³ãƒ«: å•é¡Œãªã—');
            }
            
            // 2. Web Storageç¢ºèª
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                log('âœ… Web Storage: åˆ©ç”¨å¯èƒ½');
            } catch (e) {
                log('âŒ Web Storage: ç„¡åŠ¹');
                log('âœ… è§£æ±ºæ–¹æ³•: ãƒ–ãƒ©ã‚¦ã‚¶è¨­å®šã§Cookieã‚’æœ‰åŠ¹ã«ã—ã¦ãã ã•ã„');
            }
            
            // 3. Firebaseãƒ©ã‚¤ãƒ–ãƒ©ãƒªç¢ºèª
            if (typeof firebase !== 'undefined') {
                log('âœ… Firebase SDK: èª­ã¿è¾¼ã¿æ¸ˆã¿');
                log(`- Firebase Version: ${firebase.SDK_VERSION || 'Unknown'}`);
            } else {
                log('âŒ Firebase SDK: èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼');
            }
            
            // 4. ãƒ‰ãƒ¡ã‚¤ãƒ³ç¢ºèª
            const domain = window.location.hostname;
            log(`ğŸ  ç¾åœ¨ã®ãƒ‰ãƒ¡ã‚¤ãƒ³: ${domain}`);
            
            if (domain === 'localhost' || domain === '127.0.0.1') {
                log('âœ… ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º: Firebaseè¨­å®šã§è¨±å¯ãŒå¿…è¦');
            }
            
            log('âš ï¸ === ãƒ­ã‚°ã‚¤ãƒ³å•é¡Œè¨ºæ–­ å®Œäº† ===');
        };

        // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ ç¢ºèª
        window.checkDatabaseStructure = async () => {
            if (!currentUser) {
                log('âŒ ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™');
                return;
            }
            
            log('ğŸ—ï¸ === ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ ç¢ºèª é–‹å§‹ ===');
            
            try {
                // ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®weightsãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’ç¢ºèª
                const userRef = database.ref(`users/${currentUser.uid}/weights`);
                const snapshot = await userRef.once('value');
                const data = snapshot.val();
                
                if (data) {
                    const entries = Object.keys(data);
                    log(`ğŸ“Š ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼(${currentUser.email})ã®ãƒ‡ãƒ¼ã‚¿:`);
                    log(`- ãƒ‡ãƒ¼ã‚¿è¨˜éŒ²æ•°: ${entries.length}ä»¶`);
                    log(`- æœ€æ–°è¨˜éŒ²ID: ${entries[entries.length - 1]}`);
                    
                    // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’è¡¨ç¤º
                    const sampleEntry = data[entries[0]];
                    log(`- ãƒ‡ãƒ¼ã‚¿æ§‹é€ : ${JSON.stringify(sampleEntry, null, 2)}`);
                } else {
                    log('ğŸ“Š ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
                }
                
                // ãƒ«ãƒ¼ãƒˆãƒ¬ãƒ™ãƒ«ã®æ§‹é€ ç¢ºèªï¼ˆç®¡ç†è€…æ¨©é™ãŒå¿…è¦ï¼‰
                try {
                    const rootRef = database.ref('users');
                    const rootSnapshot = await rootRef.once('value');
                    const allUsers = rootSnapshot.val();
                    
                    if (allUsers) {
                        const userCount = Object.keys(allUsers).length;
                        log(`ğŸ‘¥ å…¨ä½“çµ±è¨ˆ:`);
                        log(`- ç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°: ${userCount}äºº`);
                        
                        let totalWeights = 0;
                        Object.values(allUsers).forEach(user => {
                            if (user.weights) {
                                totalWeights += Object.keys(user.weights).length;
                            }
                        });
                        log(`- å…¨ä½“ã®ä½“é‡è¨˜éŒ²æ•°: ${totalWeights}ä»¶`);
                    }
                } catch (error) {
                    log(`âš ï¸ å…¨ä½“çµ±è¨ˆã®å–å¾—ã«åˆ¶é™ãŒã‚ã‚Šã¾ã™: ${error.message}`);
                }
                
            } catch (error) {
                log(`âŒ æ§‹é€ ç¢ºèªã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
            
            log('ğŸ—ï¸ === ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ ç¢ºèª å®Œäº† ===');
        };

        // ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’ã‚³ãƒ”ãƒ¼
        window.copyDebugInfo = () => {
            const debugInfo = `ä½“é‡ç®¡ç†ã‚¢ãƒ—ãƒª ãƒ‡ãƒãƒƒã‚°æƒ…å ±
=================================
ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—: ${new Date().toLocaleString()}
URL: ${window.location.href}
ãƒ—ãƒ­ãƒˆã‚³ãƒ«: ${window.location.protocol}
ãƒ‰ãƒ¡ã‚¤ãƒ³: ${window.location.hostname}
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ: ${navigator.userAgent}

Firebaseè¨­å®š:
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID: ${firebaseConfig.projectId}
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹URL: ${firebaseConfig.databaseURL}
- èªè¨¼ãƒ‰ãƒ¡ã‚¤ãƒ³: ${firebaseConfig.authDomain}

èªè¨¼çŠ¶æ…‹: ${currentUser ? 'ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿' : 'æœªãƒ­ã‚°ã‚¤ãƒ³'}
${currentUser ? `- UID: ${currentUser.uid.substring(0,8)}...\n- Email: ${currentUser.email}\n- è¡¨ç¤ºå: ${currentUser.displayName}` : ''}

Firebase SDK: ${typeof firebase !== 'undefined' ? 'èª­ã¿è¾¼ã¿æ¸ˆã¿' : 'èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼'}
Web Storage: ${(() => {
    try {
        localStorage.setItem('test', 'test');
        localStorage.removeItem('test');
        return 'åˆ©ç”¨å¯èƒ½';
    } catch (e) {
        return 'ç„¡åŠ¹';
    }
})()}

ãƒ­ã‚°å†…å®¹:
${document.getElementById('logArea').innerText}`;

            navigator.clipboard.writeText(debugInfo).then(() => {
                alert('âœ… ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
            }).catch(() => {
                // fallback
                const textArea = document.createElement('textarea');
                textArea.value = debugInfo;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('âœ… ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
            });
        };

        // ã‚¢ãƒ—ãƒªåˆæœŸåŒ–
        function initializeApp() {
            // ãƒãƒ¼ã‚¸ãƒ§ãƒ³è¡¨ç¤ºã®å‹•çš„è¨­å®š
            document.title = `ä½“é‡ç®¡ç†ã‚¢ãƒ—ãƒª ${APP_VERSION}`;
            document.getElementById('appTitle').textContent = `ğŸ“Š ä½“é‡ç®¡ç†ã‚¢ãƒ—ãƒª ${APP_VERSION}`;
            
            log(`ğŸš€ ä½“é‡ç®¡ç†ã‚¢ãƒ—ãƒªèµ·å‹•å®Œäº† ${APP_VERSION}`);
            log('ğŸ” èªè¨¼ã‚·ã‚¹ãƒ†ãƒ æº–å‚™å®Œäº†');
        }

        // åˆæœŸåŒ–å®Ÿè¡Œ
        initializeApp();
        
        // ãƒ—ãƒ­ãƒˆã‚³ãƒ«ãƒã‚§ãƒƒã‚¯ï¼ˆè‡ªå‹•è¨ºæ–­ï¼‰
        if (window.location.protocol === 'file:') {
            log('âš ï¸ file://ãƒ—ãƒ­ãƒˆã‚³ãƒ«æ¤œå‡º - Googleãƒ­ã‚°ã‚¤ãƒ³ã«ã¯ HTTPã‚µãƒ¼ãƒãƒ¼ãŒå¿…è¦ã§ã™');
            log('ğŸ’¡ è§£æ±ºæ–¹æ³•: python -m http.server 8000 ã¾ãŸã¯ chrome://flagsè¨­å®š');
        }

        // ========== ç¡çœ ç®¡ç†æ©Ÿèƒ½ ==========
        // ç¡çœ ç®¡ç†æ©Ÿèƒ½ã¯ tabs/tab2-sleep/tab-sleep.js ã«ç§»å‹•æ¸ˆã¿

        // ========== éƒ¨å±‹ç‰‡ä»˜ã‘æ©Ÿèƒ½ ==========
        
        // éƒ¨å±‹ç‰‡ä»˜ã‘ç”¨å¤‰æ•°ï¼ˆroom-cleaning.jsã§å®£è¨€æ¸ˆã¿ï¼‰
        
        // éƒ¨å±‹ç‰‡ä»˜ã‘ç®¡ç†åˆæœŸåŒ–
        function initRoomManagement() {
            // ç¾åœ¨ã®æ—¥ä»˜ãƒ»æ™‚åˆ»ã‚’è¨­å®š
            const now = new Date();
            const today = now.toISOString().split('T')[0];
            const currentTime = now.toTimeString().slice(0, 5);
            
            document.getElementById('roomDateInput').value = today;
            document.getElementById('roomTimeInput').value = currentTime;
            
            // ã‚«ã‚¹ã‚¿ãƒ å ´æ‰€ã‚’å¾©å…ƒ
            loadCustomRooms();
            
            log('ğŸ§¹ éƒ¨å±‹ç‰‡ä»˜ã‘ç®¡ç†åˆæœŸåŒ–å®Œäº†');
        }
        
        // å ´æ‰€ç®¡ç†ãƒ¢ãƒ¼ãƒ‰è¨­å®š
        window.setRoomMode = (mode) => {
            currentRoomMode = mode;
            
            // ãƒœã‚¿ãƒ³ã®è¦‹ãŸç›®ã‚’æ›´æ–°
            document.getElementById('roomNormalModeBtn').style.background = mode === 'normal' ? '#007bff' : '#6c757d';
            document.getElementById('roomAddModeBtn').style.background = mode === 'add' ? '#007bff' : '#6c757d';
            document.getElementById('roomDeleteModeBtn').style.background = mode === 'delete' ? '#007bff' : '#6c757d';
            
            // è¿½åŠ å…¥åŠ›ã‚¨ãƒªã‚¢ã®è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
            const addInput = document.getElementById('roomUnifiedAddInput');
            if (mode === 'add') {
                addInput.style.display = 'block';
            } else {
                addInput.style.display = 'none';
            }
            
            log(`ğŸ”§ å ´æ‰€ç®¡ç†ãƒ¢ãƒ¼ãƒ‰: ${mode}`);
        };
        
        // ç‰‡ä»˜ã‘å ´æ‰€é¸æŠ
        window.selectRoom = (room) => {
            if (currentRoomMode === 'delete') {
                // å‰Šé™¤ãƒ¢ãƒ¼ãƒ‰: ã‚«ã‚¹ã‚¿ãƒ å ´æ‰€ã®ã¿å‰Šé™¤å¯èƒ½
                const isCustomRoom = !['ãƒªãƒ“ãƒ³ã‚°', 'ã‚­ãƒƒãƒãƒ³', 'å¯å®¤', 'ãŠé¢¨å‘‚', 'ãƒˆã‚¤ãƒ¬', 'ç„é–¢', 'ãã®ä»–'].includes(room);
                if (isCustomRoom) {
                    if (confirm(`ã€Œ${room}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {
                        removeCustomRoom(room);
                    }
                } else {
                    log('âŒ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå ´æ‰€ã¯å‰Šé™¤ã§ãã¾ã›ã‚“');
                }
                return;
            }
            
            // é€šå¸¸é¸æŠ
            selectedRoomValue = room;
            document.getElementById('selectedRoom').value = room;
            
            // ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«æ›´æ–°
            document.querySelectorAll('.room-btn').forEach(btn => {
                if (btn.getAttribute('data-room') === room) {
                    btn.style.opacity = '1';
                    btn.style.transform = 'scale(1.05)';
                } else {
                    btn.style.opacity = '0.7';
                    btn.style.transform = 'scale(1)';
                }
            });
            
            log(`ğŸ“ å ´æ‰€é¸æŠ: ${room}`);
        };
        
        // ç‰‡ä»˜ã‘é–‹å§‹
        window.startRoomCleaning = () => {
            if (!selectedRoomValue) {
                log('âŒ ç‰‡ä»˜ã‘å ´æ‰€ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            roomStartTime = new Date();
            const timeString = roomStartTime.toTimeString().slice(0, 5);
            
            // ãƒœã‚¿ãƒ³è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
            document.getElementById('startRoomBtn').style.display = 'none';
            document.getElementById('endRoomBtn').style.display = 'inline-block';
            
            // æ™‚åˆ»è¡¨ç¤ºã‚’é–‹å§‹æ™‚åˆ»ã«æ›´æ–°
            document.getElementById('roomTimeInput').value = timeString;
            document.getElementById('roomDuration').value = 'è¨ˆæ¸¬ä¸­...';
            
            log(`â–¶ï¸ ç‰‡ä»˜ã‘é–‹å§‹: ${selectedRoomValue} - ${timeString}`);
        };
        
        // ç‰‡ä»˜ã‘çµ‚äº†
        window.endRoomCleaning = () => {
            if (!roomStartTime) {
                log('âŒ ç‰‡ä»˜ã‘ãŒé–‹å§‹ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                return;
            }
            
            roomEndTime = new Date();
            const duration = Math.round((roomEndTime - roomStartTime) / (1000 * 60)); // åˆ†å˜ä½
            
            // ãƒœã‚¿ãƒ³è¡¨ç¤ºã‚’æˆ»ã™
            document.getElementById('startRoomBtn').style.display = 'inline-block';
            document.getElementById('endRoomBtn').style.display = 'none';
            
            // æ™‚é–“è¡¨ç¤ºã‚’æ›´æ–°
            document.getElementById('roomDuration').value = `${duration}åˆ†`;
            
            log(`â¹ï¸ ç‰‡ä»˜ã‘çµ‚äº†: ${selectedRoomValue} - ${duration}åˆ†é–“`);
        };
        
        // é”æˆåº¦é¸æŠ
        window.selectAchievement = (level) => {
            selectedRoomAchievement = level;
            document.getElementById('selectedAchievement').value = `${level}/5`;
            
            // ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«æ›´æ–°
            document.querySelectorAll('.achievement-btn').forEach(btn => {
                btn.style.opacity = '0.7';
                btn.style.transform = 'scale(1)';
            });
            
            const selectedBtn = document.querySelector(`[onclick="selectAchievement(${level})"]`);
            if (selectedBtn) {
                selectedBtn.style.opacity = '1';
                selectedBtn.style.transform = 'scale(1.1)';
            }
            
            log(`ğŸ“Š é”æˆåº¦é¸æŠ: ${level}/5`);
        };
        
        // ã‚«ã‚¹ã‚¿ãƒ å ´æ‰€è¿½åŠ 
        window.executeRoomAdd = () => {
            const roomName = document.getElementById('roomUnifiedAddText').value.trim();
            if (!roomName) {
                log('âŒ å ´æ‰€åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            // é‡è¤‡ãƒã‚§ãƒƒã‚¯
            const existingBtn = document.querySelector(`[data-room="${roomName}"]`);
            if (existingBtn) {
                log(`âŒ ã€Œ${roomName}ã€ã¯æ—¢ã«å­˜åœ¨ã—ã¾ã™`);
                return;
            }
            
            // ãƒœã‚¿ãƒ³ã‚’è¿½åŠ 
            addCustomRoomButton(roomName);
            
            // ã‚«ã‚¹ã‚¿ãƒ å ´æ‰€ã‚’localStorageã«ä¿å­˜
            saveCustomRooms();
            
            // å…¥åŠ›ã‚’ã‚¯ãƒªã‚¢
            document.getElementById('roomUnifiedAddText').value = '';
            setRoomMode('normal');
            
            log(`âœ… æ–°ã—ã„å ´æ‰€è¿½åŠ : ${roomName}`);
        };
        
        // ã‚«ã‚¹ã‚¿ãƒ å ´æ‰€è¿½åŠ ã‚­ãƒ£ãƒ³ã‚»ãƒ«
        window.cancelRoomAdd = () => {
            document.getElementById('roomUnifiedAddText').value = '';
            setRoomMode('normal');
            log('âŒ å ´æ‰€è¿½åŠ ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«');
        };
        
        // ã‚«ã‚¹ã‚¿ãƒ å ´æ‰€å‰Šé™¤
        function removeCustomRoom(roomName) {
            const roomBtn = document.querySelector(`[data-room="${roomName}"]`);
            if (roomBtn) {
                roomBtn.remove();
                saveCustomRooms(); // å‰Šé™¤å¾Œã«ä¿å­˜
                log(`ğŸ—‘ï¸ å ´æ‰€å‰Šé™¤: ${roomName}`);
            }
        }
        
        // ã‚«ã‚¹ã‚¿ãƒ å ´æ‰€ãƒœã‚¿ãƒ³ä½œæˆ
        function addCustomRoomButton(roomName) {
            const roomButtons = document.getElementById('roomButtons');
            const newButton = document.createElement('button');
            newButton.type = 'button';
            newButton.className = 'room-btn';
            newButton.onclick = () => selectRoom(roomName);
            newButton.setAttribute('data-room', roomName);
            newButton.style.cssText = 'background: #e74c3c; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 12px; opacity: 0.7;';
            newButton.textContent = `ğŸ  ${roomName}`;
            
            roomButtons.appendChild(newButton);
        }
        
        // ã‚«ã‚¹ã‚¿ãƒ å ´æ‰€ã‚’localStorageã«ä¿å­˜
        function saveCustomRooms() {
            const defaultRooms = ['ãƒªãƒ“ãƒ³ã‚°', 'ã‚­ãƒƒãƒãƒ³', 'å¯å®¤', 'ãŠé¢¨å‘‚', 'ãƒˆã‚¤ãƒ¬', 'ç„é–¢', 'ãã®ä»–'];
            const customRooms = Array.from(document.querySelectorAll('.room-btn'))
                .map(btn => btn.getAttribute('data-room'))
                .filter(room => !defaultRooms.includes(room));
            
            localStorage.setItem('roomApp_customRooms', JSON.stringify(customRooms));
            log(`ğŸ’¾ ã‚«ã‚¹ã‚¿ãƒ å ´æ‰€ä¿å­˜: ${customRooms.length}ä»¶`);
        }
        
        // ã‚«ã‚¹ã‚¿ãƒ å ´æ‰€ã‚’localStorageã‹ã‚‰å¾©å…ƒ
        function loadCustomRooms() {
            try {
                const saved = localStorage.getItem('roomApp_customRooms');
                if (saved) {
                    const customRooms = JSON.parse(saved);
                    customRooms.forEach(roomName => {
                        addCustomRoomButton(roomName);
                    });
                    log(`ğŸ“‚ ã‚«ã‚¹ã‚¿ãƒ å ´æ‰€å¾©å…ƒ: ${customRooms.length}ä»¶`);
                }
            } catch (error) {
                log(`âŒ ã‚«ã‚¹ã‚¿ãƒ å ´æ‰€å¾©å…ƒã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }
        
        // éƒ¨å±‹ç‰‡ä»˜ã‘ãƒ‡ãƒ¼ã‚¿ä¿å­˜
        window.saveRoomData = async () => {
            if (!currentUser) {
                log('âŒ ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™');
                return;
            }
            
            if (!selectedRoomValue) {
                log('âŒ ç‰‡ä»˜ã‘å ´æ‰€ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            if (!selectedRoomAchievement) {
                log('âŒ é”æˆåº¦ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            const duration = document.getElementById('roomDuration').value;
            if (duration === 'é–‹å§‹ãƒœã‚¿ãƒ³ã§è¨ˆæ¸¬é–‹å§‹' || duration === 'è¨ˆæ¸¬ä¸­...') {
                log('âŒ ç‰‡ä»˜ã‘æ™‚é–“ã‚’è¨ˆæ¸¬ã—ã¦ãã ã•ã„');
                return;
            }
            
            try {
                log('ğŸ’¾ éƒ¨å±‹ç‰‡ä»˜ã‘ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ä¸­...');
                
                const roomData = {
                    date: document.getElementById('roomDateInput').value,
                    time: document.getElementById('roomTimeInput').value,
                    room: selectedRoomValue,
                    duration: duration,
                    achievement: selectedRoomAchievement,
                    memo: document.getElementById('roomMemoInput').value || '',
                    userEmail: currentUser.email,
                    timestamp: firebase.database.ServerValue.TIMESTAMP,
                    createdAt: new Date().toISOString()
                };
                
                const userRef = database.ref(`users/${currentUser.uid}/roomData`);
                await userRef.push(roomData);
                
                log(`âœ… ç‰‡ä»˜ã‘è¨˜éŒ²ä¿å­˜å®Œäº†: ${selectedRoomValue} - ${duration} (é”æˆåº¦${selectedRoomAchievement}/5)`);
                
                // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
                resetRoomForm();
                
                // ãƒ‡ãƒ¼ã‚¿å†èª­ã¿è¾¼ã¿
                await loadRoomData();
                
            } catch (error) {
                log(`âŒ ä¿å­˜ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        };
        
        // éƒ¨å±‹ç‰‡ä»˜ã‘ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ï¼ˆå¤–éƒ¨JSãƒ•ã‚¡ã‚¤ãƒ«ã§å®šç¾©æ¸ˆã¿ï¼‰
        
        // ãƒ•ã‚©ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
        function resetRoomForm() {
            selectedRoomValue = '';
            selectedRoomAchievement = null;
            roomStartTime = null;
            roomEndTime = null;
            
            document.getElementById('selectedRoom').value = '';
            document.getElementById('selectedAchievement').value = '';
            document.getElementById('roomDuration').value = 'é–‹å§‹ãƒœã‚¿ãƒ³ã§è¨ˆæ¸¬é–‹å§‹';
            document.getElementById('roomMemoInput').value = '';
            
            // ãƒœã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.querySelectorAll('.room-btn').forEach(btn => {
                btn.style.opacity = '0.7';
                btn.style.transform = 'scale(1)';
            });
            document.querySelectorAll('.achievement-btn').forEach(btn => {
                btn.style.opacity = '0.7';
                btn.style.transform = 'scale(1)';
            });
            
            // é–‹å§‹ãƒ»çµ‚äº†ãƒœã‚¿ãƒ³ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('startRoomBtn').style.display = 'inline-block';
            document.getElementById('endRoomBtn').style.display = 'none';
            
            // æ—¥æ™‚ã‚’ç¾åœ¨æ™‚åˆ»ã«æ›´æ–°
            const now = new Date();
            document.getElementById('roomDateInput').value = now.toISOString().split('T')[0];
            document.getElementById('roomTimeInput').value = now.toTimeString().slice(0, 5);
        }
        
        // éƒ¨å±‹ç‰‡ä»˜ã‘å±¥æ­´è¡¨ç¤ºæ›´æ–°
        function updateRoomHistory() {
            log('ğŸ” updateRoomHistory() é–‹å§‹');
            const historyArea = document.getElementById('roomHistoryArea');
            
            log(`ğŸ“Š éƒ¨å±‹ãƒ‡ãƒ¼ã‚¿ä»¶æ•°: ${allRoomData.length}`);
            log('ğŸ” historyAreaè¦ç´ :', historyArea ? 'å­˜åœ¨' : 'è¦‹ã¤ã‹ã‚‰ãªã„');
            
            if (!historyArea) {
                log('âŒ roomHistoryAreaè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return;
            }
            
            if (allRoomData.length === 0) {
                historyArea.innerHTML = 'ã¾ã ç‰‡ä»˜ã‘è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“';
                log('â„¹ï¸ éƒ¨å±‹ãƒ‡ãƒ¼ã‚¿ãªã— - ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼è¡¨ç¤º');
                return;
            }
            
            // ç›´è¿‘7ä»¶è¡¨ç¤º
            const recentData = allRoomData.slice(0, 7);
            log(`ğŸ“‹ è¡¨ç¤ºãƒ‡ãƒ¼ã‚¿ä»¶æ•°: ${recentData.length}`);
            
            historyArea.innerHTML = recentData.map(data => {
                let content = `<strong>${data.date}</strong> ${data.time} `;
                content += `ğŸ“ ${data.room} `;
                content += `â±ï¸ ${data.duration} `;
                content += `ğŸ“Š ${data.achievement}/5`;
                if (data.memo) {
                    content += `<br>ğŸ“ ${data.memo}`;
                }
                
                return `<div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding: 10px 0;">
                    <div>${content}</div>
                    <button onclick="deleteRoomEntry('${data.id}')" style="background: #dc3545; color: white; border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer; font-size: 12px; flex-shrink: 0;">ğŸ—‘ï¸</button>
                </div>`;
            }).join('');
            
            log('âœ… updateRoomHistory() å®Œäº†');
        }
        
        // éƒ¨å±‹ç‰‡ä»˜ã‘çµ±è¨ˆæ›´æ–°
        function updateRoomStats() {
            const totalSessions = allRoomData.length;
            const totalMinutes = allRoomData.reduce((sum, data) => {
                const minutes = parseInt(data.duration) || 0;
                return sum + minutes;
            }, 0);
            const avgAchievement = totalSessions > 0 ? 
                (allRoomData.reduce((sum, data) => sum + (data.achievement || 0), 0) / totalSessions).toFixed(1) : 0;
            
            // ä»Šæœˆã®è¨˜éŒ²æ•°
            const thisMonth = new Date().toISOString().slice(0, 7); // YYYY-MM
            const thisMonthCount = allRoomData.filter(data => data.date.startsWith(thisMonth)).length;
            
            document.getElementById('totalRoomSessions').textContent = totalSessions;
            document.getElementById('totalRoomTime').textContent = `${totalMinutes}åˆ†`;
            document.getElementById('avgRoomAchievement').textContent = avgAchievement;
            document.getElementById('thisMonthRoomCount').textContent = thisMonthCount;
        }
        
        // éƒ¨å±‹ç‰‡ä»˜ã‘å±¥æ­´ã‚³ãƒ”ãƒ¼
        window.copyRoomHistory = () => {
            if (allRoomData.length === 0) {
                log('ğŸ“‹ ã‚³ãƒ”ãƒ¼ã™ã‚‹ç‰‡ä»˜ã‘ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }
            
            const copyText = allRoomData.slice(0, 7).map(data => 
                `${data.date} ${data.time} ${data.room} ${data.duration} é”æˆåº¦${data.achievement}/5${data.memo ? ` ${data.memo}` : ''}`
            ).join('\n');
            
            navigator.clipboard.writeText(copyText).then(() => {
                log('ğŸ“‹ ç‰‡ä»˜ã‘å±¥æ­´ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
            }).catch(() => {
                log('âŒ ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ');
            });
        };
        
        // éƒ¨å±‹ç‰‡ä»˜ã‘ãƒ‡ãƒ¼ã‚¿å‰Šé™¤
        window.deleteRoomEntry = async (entryId) => {
            if (!currentUser) {
                log('âŒ ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™');
                return;
            }
            
            if (!confirm('ã“ã®ç‰‡ä»˜ã‘è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                return;
            }
            
            try {
                const entryRef = database.ref(`users/${currentUser.uid}/roomData/${entryId}`);
                await entryRef.remove();
                
                log('ğŸ—‘ï¸ ç‰‡ä»˜ã‘è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
                await loadRoomData();
                
            } catch (error) {
                log(`âŒ å‰Šé™¤ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        };

        // ===================== 
        // ãƒ¡ãƒ¢ãƒªã‚¹ãƒˆæ©Ÿèƒ½ (åˆ†é›¢æ¸ˆã¿ - memo-list.jsã«ç§»å‹•) - å…¨ã¦ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ
        /*
        // =====================
        // let memoData = [];

        // é‡è¦åº¦ã®è‰²ã‚’å–å¾—
        function getPriorityColor(priority) {
            switch(priority) {
                case 'S': return '#dc3545'; // èµ¤
                case 'A': return '#fd7e14'; // ã‚ªãƒ¬ãƒ³ã‚¸
                case 'B': return '#ffc107'; // é»„è‰²
                case 'C': return '#6c757d'; // ã‚°ãƒ¬ãƒ¼
                default: return '#6c757d';
            }
        }

        // é‡è¦åº¦ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’å–å¾—
        function getPriorityIcon(priority) {
            switch(priority) {
                case 'S': return 'ğŸ”¥';
                case 'A': return 'âš¡';
                case 'B': return 'ğŸ“‹';
                case 'C': return 'ğŸ“';
                default: return '';
            }
        }

        // å¯¾å¿œæ™‚é–“ã®è‰²ã‚’å–å¾—
        function getTimeframeColor(timeframe) {
            switch(timeframe) {
                case 'çŸ­æœŸ': return '#28a745'; // ç·‘
                case 'ä¸­é•·æœŸ': return '#17a2b8'; // é’
                default: return '#6c757d';
            }
        }

        // å¯¾å¿œæ™‚é–“ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’å–å¾—
        function getTimeframeIcon(timeframe) {
            switch(timeframe) {
                case 'çŸ­æœŸ': return 'âš¡';
                case 'ä¸­é•·æœŸ': return 'ğŸ“…';
                default: return '';
            }
        }

        // ãƒ¡ãƒ¢ã‚’è¿½åŠ 
        window.addMemo = () => {
            const memoText = document.getElementById('newMemoText').value.trim();
            const category = document.getElementById('memoCategory').value;
            const priority = document.getElementById('memoPriority').value;
            const timeframe = document.getElementById('memoTimeframe').value;
            
            if (!memoText) {
                alert('ãƒ¡ãƒ¢å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            const now = new Date();
            const memo = {
                id: Date.now(),
                text: memoText,
                category: category,
                priority: priority,
                timeframe: timeframe,
                timestamp: now.toISOString(),
                date: now.toLocaleDateString('ja-JP'),
                time: now.toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' })
            };
            
            memoData.unshift(memo); // æ–°ã—ã„ãƒ¡ãƒ¢ã‚’å…ˆé ­ã«è¿½åŠ 
            
            // Firebaseã«ä¿å­˜
            if (currentUser) {
                saveMemoToFirebase(memo);
            } else {
                // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
                localStorage.setItem('memos', JSON.stringify(memoData));
            }
            
            // è¡¨ç¤ºã‚’æ›´æ–°
            updateMemoDisplay();
            updateMemoStats();
            
            // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢
            document.getElementById('newMemoText').value = '';
            document.getElementById('memoCategory').value = '';
            document.getElementById('memoPriority').value = '';
            document.getElementById('memoTimeframe').value = '';
            
            log(`ğŸ“ ãƒ¡ãƒ¢ã‚’è¿½åŠ ã—ã¾ã—ãŸ${category ? ` [${category}]` : ''}: ${memoText.substring(0, 30)}${memoText.length > 30 ? '...' : ''}`);
        };

        // Firebaseã«ãƒ¡ãƒ¢ã‚’ä¿å­˜
        function saveMemoToFirebase(memo) {
            if (!currentUser || !firebase.database) return;
            
            firebase.database().ref(`users/${currentUser.uid}/memos/${memo.id}`).set(memo)
            .then(() => {
                console.log('ãƒ¡ãƒ¢ã‚’Firebaseã«ä¿å­˜ã—ã¾ã—ãŸ');
            })
            .catch((error) => {
                console.error('Firebaseã¸ã®ä¿å­˜ã«å¤±æ•—:', error);
                log('âŒ ãƒ¡ãƒ¢ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
            });
        }

        // ãƒ¡ãƒ¢è¡¨ç¤ºã‚’æ›´æ–°
        function updateMemoDisplay() {
            log('ğŸ” updateMemoDisplay() é–‹å§‹');
            const container = document.getElementById('memoListArea');
            
            log(`ğŸ“Š ãƒ¡ãƒ¢ãƒ‡ãƒ¼ã‚¿ä»¶æ•°: ${memoData.length}`);
            log('ğŸ” memoListAreaè¦ç´ :', container ? 'å­˜åœ¨' : 'è¦‹ã¤ã‹ã‚‰ãªã„');
            
            if (!container) {
                log('âŒ memoListAreaè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return;
            }
            
            if (memoData.length === 0) {
                container.innerHTML = 'ã¾ã ãƒ¡ãƒ¢ãŒã‚ã‚Šã¾ã›ã‚“';
                log('â„¹ï¸ ãƒ¡ãƒ¢ãƒ‡ãƒ¼ã‚¿ãªã— - ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼è¡¨ç¤º');
                return;
            }
            
            const html = memoData.map(memo => {
                const categoryBadge = memo.category ? 
                    `<span style="background: #6c757d; color: white; padding: 2px 6px; border-radius: 10px; font-size: 10px; margin-right: 5px;">${memo.category}</span>` : '';
                
                // é‡è¦åº¦ã®ãƒãƒƒã‚¸
                const priorityBadge = memo.priority ? 
                    `<span style="background: ${getPriorityColor(memo.priority)}; color: white; padding: 2px 6px; border-radius: 10px; font-size: 10px; margin-right: 5px; font-weight: bold;">${getPriorityIcon(memo.priority)} ${memo.priority}</span>` : '';
                
                // å¯¾å¿œæ™‚é–“ã®ãƒãƒƒã‚¸
                const timeframeBadge = memo.timeframe ? 
                    `<span style="background: ${getTimeframeColor(memo.timeframe)}; color: white; padding: 2px 6px; border-radius: 10px; font-size: 10px; margin-right: 5px;">${getTimeframeIcon(memo.timeframe)} ${memo.timeframe}</span>` : '';
                
                return `
                    <div class="memo-item">
                        <div class="memo-header">
                            <div style="flex: 1;">
                                ${priorityBadge}${timeframeBadge}${categoryBadge}
                                <small class="memo-date">${memo.date} ${memo.time}</small>
                            </div>
                            <button onclick="deleteMemo(${memo.id})" class="memo-delete-btn">ğŸ—‘ï¸</button>
                        </div>
                        <div class="memo-text">
                            ${memo.text}
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = html;
            
            log('âœ… updateMemoDisplay() å®Œäº†');
        }

        // ãƒ¡ãƒ¢ã‚’å‰Šé™¤
        window.deleteMemo = (memoId) => {
            if (!confirm('ã“ã®ãƒ¡ãƒ¢ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                return;
            }
            
            memoData = memoData.filter(memo => memo.id !== memoId);
            
            // Firebaseã‹ã‚‰å‰Šé™¤
            if (currentUser) {
                firebase.database().ref(`users/${currentUser.uid}/memos/${memoId}`).remove();
            } else {
                // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’æ›´æ–°
                localStorage.setItem('memos', JSON.stringify(memoData));
            }
            
            updateMemoDisplay();
            updateMemoStats();
            log('ğŸ—‘ï¸ ãƒ¡ãƒ¢ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
        };

        // clearAllMemosé–¢æ•°ã¯å®‰å…¨ä¸Šã®ç†ç”±ã«ã‚ˆã‚Šå®Œå…¨å‰Šé™¤æ¸ˆã¿

        // ãƒ¡ãƒ¢çµ±è¨ˆã‚’æ›´æ–°
        function updateMemoStats() {
            const now = new Date();
            const today = now.toLocaleDateString('ja-JP');
            
            // ä»Šé€±ã®é–‹å§‹æ—¥ï¼ˆæœˆæ›œæ—¥ï¼‰ã‚’è¨ˆç®—
            const weekStart = new Date(now);
            weekStart.setDate(now.getDate() - ((now.getDay() + 6) % 7));
            weekStart.setHours(0, 0, 0, 0);
            
            // ä»Šæœˆã®é–‹å§‹æ—¥ã‚’è¨ˆç®—
            const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
            
            const todayCount = memoData.filter(memo => memo.date === today).length;
            const weekCount = memoData.filter(memo => new Date(memo.timestamp) >= weekStart).length;
            const monthCount = memoData.filter(memo => new Date(memo.timestamp) >= monthStart).length;
            
            document.getElementById('totalMemoCount').textContent = memoData.length;
            document.getElementById('todayMemoCount').textContent = todayCount;
            document.getElementById('weekMemoCount').textContent = weekCount;
            document.getElementById('monthMemoCount').textContent = monthCount;
        }

        // å…¨ãƒ¡ãƒ¢ã‚’ã‚³ãƒ”ãƒ¼
        window.copyAllMemos = () => {
            if (memoData.length === 0) {
                alert('ã‚³ãƒ”ãƒ¼ã™ã‚‹ãƒ¡ãƒ¢ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }
            
            const copyText = memoData.map(memo => {
                const categoryText = memo.category ? `[${memo.category}] ` : '';
                return `${memo.date} ${memo.time} ${categoryText}${memo.text}`;
            }).join('\n\n');
            
            navigator.clipboard.writeText(copyText).then(() => {
                log('ğŸ“‹ å…¨ãƒ¡ãƒ¢ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
            }).catch(() => {
                log('âŒ ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ');
            });
        };

        // ãƒ¡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
        function loadMemoData() {
            log('ğŸ“š loadMemoData() é–‹å§‹');
            if (currentUser) {
                // Firebaseã‹ã‚‰èª­ã¿è¾¼ã¿
                firebase.database().ref(`users/${currentUser.uid}/memos`).on('value', (snapshot) => {
                    log('ğŸ”¥ Firebaseã‹ã‚‰ãƒ¡ãƒ¢ãƒ‡ãƒ¼ã‚¿å–å¾—ä¸­...');
                    const data = snapshot.val();
                    if (data) {
                        memoData = Object.values(data).sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                        log(`âœ… ãƒ¡ãƒ¢ãƒ‡ãƒ¼ã‚¿${memoData.length}ä»¶ã‚’å–å¾—`);
                    } else {
                        memoData = [];
                        log('â„¹ï¸ Firebaseã«ãƒ¡ãƒ¢ãƒ‡ãƒ¼ã‚¿ãªã—');
                    }
                    log('ğŸ”„ updateMemoDisplay()ã€updateMemoStats()ã‚’å‘¼ã³å‡ºã—');
                    updateMemoDisplay();
                    updateMemoStats();
                });
            } else {
                // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰èª­ã¿è¾¼ã¿
                const stored = localStorage.getItem('memos');
                if (stored) {
                    memoData = JSON.parse(stored);
                }
                updateMemoDisplay();
                updateMemoStats();
            }
        }

        // Enterã‚­ãƒ¼ã§ãƒ¡ãƒ¢è¿½åŠ ï¼ˆCtrl+Enterã®å ´åˆï¼‰
        document.addEventListener('DOMContentLoaded', () => {
            const memoTextArea = document.getElementById('newMemoText');
            if (memoTextArea) {
                memoTextArea.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && e.ctrlKey) {
                        e.preventDefault();
                        addMemo();
                    }
                });
            }
            
            // æœªãƒ­ã‚°ã‚¤ãƒ³æ™‚ã®ãƒ¡ãƒ¢ãƒ‡ãƒ¼ã‚¿åˆæœŸåŒ–
            if (!currentUser) {
                loadMemoData();
            }
        });
        */ // ãƒ¡ãƒ¢ãƒªã‚¹ãƒˆæ©Ÿèƒ½ã‚³ãƒ¡ãƒ³ãƒˆçµ‚äº†

    </script>
</body>
</html>
