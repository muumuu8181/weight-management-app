# JavaScript分離作業における厳格なルール

**関連文書**: [JavaScript分離可能性分析レポート](./javascript-separation-analysis.md)

## 🚫 **絶対禁止事項** 🚫

### **勝手な改善・最適化の禁止**
- 指示されていない「改善」「最適化」「カスタマイズ」
- 動作しているコードへの「勝手な変更」
- HTMLのインデント・構造の変更
- CSSクラス名・ID名の変更
- 既存JavaScript関数名の変更
- コメントの追加・削除・修正
- 変数名のリネーミング
- コード整理・リファクタリング

### **構造破壊の禁止**
- HTMLタグの属性値変更
- スタイル属性の修正
- onclick属性の変更
- データ属性の修正
- 既存の依存関係の変更

## ✅ **許可される作業のみ**

### **1. 完全コピー作業**
- 明示的に指示されたコードの完全コピー
- 指定された場所への正確な移動
- 一切の変更を加えない転写

### **2. 必須の事前作業**
- バックアップファイル作成
- 作業対象範囲の明確化
- 依存関係の事前確認

### **3. 検証作業**
- コピー前後の差分確認
- 動作確認
- 第三者チェック依頼

## 📋 **作業手順**

### **Phase 1: 準備**
1. **バックアップ作成**
   ```bash
   cp index.html index.html.backup-$(date +%Y%m%d-%H%M%S)
   ```

2. **作業範囲特定**
   - 移動対象の関数名リスト作成
   - 行数範囲の明確化
   - 依存関係の確認

### **Phase 2: 実行**
1. **1関数ずつ段階的移動**
   - 一度に複数関数を移動しない
   - 完全コピー（一切変更しない）
   - 移動後は元の場所から削除

2. **即座の動作確認**
   - 各段階で動作テスト
   - エラー発生時は即座に復旧

### **Phase 3: 検証**
1. **差分確認**
   ```bash
   diff -u original.html modified.html
   ```

2. **動作確認**
   - 全タブの動作確認
   - JavaScript関数の動作確認
   - Firebase接続確認

## 🔍 **破壊検出基準**

### **レベル1: 軽微な破壊**
- HTMLの不要な改行・インデント変更
- コメントの追加・削除
- 変数名の不要な変更
- **対処**: 即座に元に戻す

### **レベル2: 機能破壊**
- JavaScript関数が動作しない
- ボタンクリックが効かない
- データ保存・読み込み失敗
- **対処**: バックアップから復旧

### **レベル3: 構造破壊**
- タブ切り替えが機能しない
- Firebase接続エラー
- ページが正常に表示されない
- **対処**: 作業全体をロールバック

## 🤖 **AI作業者への指示**

### **コピー専用モード宣言**
作業開始時に以下を宣言：
> 「私は現在『コピー専用モード』で作業します。指示されたコードを一切変更せず、完全にそのままコピーします。改善提案・最適化・カスタマイズは一切行いません。」

### **禁止行動の再確認**
- 「より良い書き方」の提案禁止
- 「効率的な実装」への変更禁止
- 「読みやすさ向上」の修正禁止
- 「ベストプラクティス」の適用禁止

## 🔄 **第三者チェック依頼テンプレート**

### **チェック依頼文**
```
【JavaScript分離作業チェック依頼】

作業内容:
- 対象ファイル: index.html → tabs/[tab-name]/[tab-name].js
- 移動した関数: [関数名リスト]
- 作業日時: [YYYY-MM-DD HH:MM]

確認項目:
□ 移動した関数が完全に同じ内容か
□ 元の場所から正しく削除されているか
□ 新しい場所で正しく動作するか
□ 他の機能に影響を与えていないか
□ バックアップが正しく作成されているか

バックアップファイル: [ファイル名]

【依頼理由】
過去にAIによる「勝手な改善」で機能破壊が発生しているため、
客観的な検証が必要です。

チェック結果をお願いします。
```

### **自動チェック依頼のタイミング**
- 各関数移動完了時
- 1つのタブの分離完了時
- 全作業完了時
- エラー・問題発生時

## ⚠️ **緊急復旧手順**

### **問題発見時の対応**
1. **即座に作業停止**
2. **バックアップからの復旧**
   ```bash
   cp index.html.backup-[timestamp] index.html
   ```
3. **問題分析・報告**
4. **作業方針の再検討**

## 📊 **作業記録**

### **必須記録項目**
- 作業開始・終了時刻
- 移動した関数名
- 発生した問題
- 復旧作業
- チェック結果

### **成功基準**
- 全ての既存機能が正常動作
- JavaScriptエラーが発生しない
- 元のコードとの差分が意図した移動のみ
- 第三者チェックでOKが出る

---

**重要**: このルールは「AIの勝手な改善」による機能破壊を防ぐために策定されました。どんなに「良いアイデア」があっても、指示されていない変更は一切行ってはいけません。

**作成日**: 2025-09-01  
**対象プロジェクト**: 体重管理アプリ  
**適用範囲**: JavaScript分離作業全般