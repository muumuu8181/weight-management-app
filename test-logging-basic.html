<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ログシステム基本動作確認</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .success { color: green; }
        .error { color: red; }
        button { margin: 5px; padding: 8px 15px; }
        #logArea { 
            background: #f5f5f5; 
            padding: 10px; 
            margin: 10px 0;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>ログシステム動作確認</h1>
    
    <div class="test-section">
        <h2>1. 基本動作テスト</h2>
        <button onclick="testBasicLog()">log()関数テスト</button>
        <button onclick="testConsoleLog()">console.logテスト</button>
        <button onclick="testErrorLog()">エラーログテスト</button>
        <button onclick="testMultipleArgs()">複数引数テスト</button>
    </div>
    
    <div class="test-section">
        <h2>2. 互換性レイヤー状態</h2>
        <button onclick="checkCompatibilityStatus()">ステータス確認</button>
        <button onclick="checkHealth()">ヘルスチェック</button>
        <button onclick="resetStats()">統計リセット</button>
    </div>
    
    <div class="test-section">
        <h2>3. パフォーマンステスト</h2>
        <button onclick="runQuickPerformanceTest()">クイックテスト（100回）</button>
        <div id="performanceResult"></div>
    </div>
    
    <div class="test-section">
        <h2>ログ出力エリア</h2>
        <div id="logArea"></div>
    </div>
    
    <div id="testResults"></div>

    <!-- 必要なスクリプトの読み込み -->
    <script src="shared/utils/logging.js"></script>
    <script src="shared/utils/universal-logger.js"></script>
    <script src="shared/utils/logging-compatibility.js"></script>
    
    <script>
        function showResult(message, isSuccess = true) {
            const resultsDiv = document.getElementById('testResults');
            const div = document.createElement('div');
            div.className = isSuccess ? 'success' : 'error';
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            resultsDiv.appendChild(div);
        }
        
        function testBasicLog() {
            try {
                log('✅ 基本的なlog()関数のテスト');
                showResult('log()関数: 正常動作');
            } catch (e) {
                showResult('log()関数: エラー - ' + e.message, false);
            }
        }
        
        function testConsoleLog() {
            try {
                console.log('📊 console.logのテスト');
                showResult('console.log: 正常動作');
            } catch (e) {
                showResult('console.log: エラー - ' + e.message, false);
            }
        }
        
        function testErrorLog() {
            try {
                console.error('❌ console.errorのテスト');
                log('⚠️ 警告メッセージのテスト');
                showResult('エラーログ: 正常動作');
            } catch (e) {
                showResult('エラーログ: エラー - ' + e.message, false);
            }
        }
        
        function testMultipleArgs() {
            try {
                log('複数引数テスト:', 123, { key: 'value' }, [1, 2, 3]);
                showResult('複数引数: 正常動作');
            } catch (e) {
                showResult('複数引数: エラー - ' + e.message, false);
            }
        }
        
        function checkCompatibilityStatus() {
            if (window.LoggingCompatibility) {
                const status = {
                    version: window.LoggingCompatibility.version,
                    initialized: window.LoggingCompatibility.initialized,
                    stats: window.LoggingCompatibility.stats
                };
                log('🔍 互換性レイヤーステータス:');
                log(JSON.stringify(status, null, 2));
                showResult('ステータス確認: 完了');
            } else {
                showResult('互換性レイヤーが見つかりません', false);
            }
        }
        
        function checkHealth() {
            if (window.LoggingCompatibility && window.LoggingCompatibility.checkHealth) {
                const health = window.LoggingCompatibility.checkHealth();
                log('🏥 ヘルスチェック結果:');
                log(JSON.stringify(health, null, 2));
                showResult(`ヘルスチェック: ${health.status}`);
            } else {
                showResult('ヘルスチェック機能が利用できません', false);
            }
        }
        
        function resetStats() {
            if (window.LoggingCompatibility && window.LoggingCompatibility.resetStats) {
                window.LoggingCompatibility.resetStats();
                log('🔄 統計をリセットしました');
                showResult('統計リセット: 完了');
            } else {
                showResult('リセット機能が利用できません', false);
            }
        }
        
        function runQuickPerformanceTest() {
            const iterations = 100;
            const start = performance.now();
            
            for (let i = 0; i < iterations; i++) {
                log(`Performance test ${i}`);
            }
            
            const end = performance.now();
            const duration = end - start;
            const avgTime = duration / iterations;
            
            const resultDiv = document.getElementById('performanceResult');
            resultDiv.innerHTML = `
                <p>実行時間: ${duration.toFixed(2)}ms</p>
                <p>平均時間: ${avgTime.toFixed(4)}ms/log</p>
                <p>処理速度: ${((iterations / duration) * 1000).toFixed(0)} logs/sec</p>
            `;
            
            showResult('パフォーマンステスト: 完了');
        }
        
        // ページロード時の初期チェック
        window.addEventListener('DOMContentLoaded', () => {
            if (window.LoggingCompatibility) {
                showResult(`✅ ログシステム互換性レイヤー v${window.LoggingCompatibility.version} 検出`);
            } else {
                showResult('❌ 互換性レイヤーが読み込まれていません', false);
            }
            
            if (window.log) {
                showResult('✅ log()関数が利用可能');
            } else {
                showResult('❌ log()関数が見つかりません', false);
            }
            
            if (window.UniversalLogger) {
                showResult('✅ UniversalLoggerが利用可能');
            } else {
                showResult('❌ UniversalLoggerが見つかりません', false);
            }
        });
    </script>
</body>
</html>