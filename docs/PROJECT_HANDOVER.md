# 体重管理アプリ - プロジェクト引き継ぎ文書

## プロジェクト概要

### アプリケーション名
**体重管理アプリ** (Weight Management App)

### 現在のバージョン
**v0.39** → **v0.40** (チャートナビゲーション機能追加完了)

### アーキテクチャ
- **タブベースの拡張可能システム**
- **Firebase Realtime Database** + **Google Authentication**
- **Chart.js** による可視化
- **レスポンシブデザイン** (モバイルファースト)

## プロジェクト方針とバージョン管理

### バージョンアップ戦略
- **0.01刻みでの細かいバージョン管理**
- 各機能追加・改善ごとに必ずバージョンアップ
- 後方互換性を維持しながら段階的に機能拡張

### 開発方針
1. **既存機能の完全保持** - 新機能追加時も既存機能を破壊しない
2. **モジュラー設計** - タブごとに独立した機能実装
3. **段階的拡張** - 4つ目、5つ目のタブ追加を前提とした設計
4. **ユーザビリティ重視** - 直感的な操作とフィードバック

## 現在のタブ構成

### タブ1: 体重管理 (完成)
**パス**: `tabs/tab1-weight/`
- **機能**: 体重記録、チャート表示、統計情報
- **特徴**: 
  - 複数回測定対応（1日内で複数回記録可能）
  - 期間別チャート表示（1日〜1年、全期間）
  - **NEW**: 左右ナビゲーション機能（期間単位での移動）
  - カスタムタイミング・服装記録
  - 統一モードコントロール（追加・削除・通常モード）

### タブ2: 睡眠管理 (完成)
**パス**: `tabs/tab2-sleep/`
- **機能**: 睡眠記録、睡眠の質評価、統計表示
- **特徴**:
  - 睡眠タイプ選択（夜間睡眠、昼寝、仮眠）
  - 就寝・起床時間の自動計算
  - 睡眠の質評価（1-5点）
  - 統計情報（平均睡眠時間、質、記録数）

### タブ3: 未実装 (プレースホルダー)
**パス**: `tabs/tab3-xxx3/`
- **状態**: 基本ファイル構造のみ
- **予定**: 将来の機能拡張用

## 技術的な重要ポイント

### Firebase設定
- **認証**: Google OAuth
- **データベース**: Realtime Database
- **構造**: `/users/{uid}/weightData/`, `/users/{uid}/sleepData/`

### Chart.jsの実装詳細
- **時系列チャート**: 1日表示は時間軸、複数日は日付軸
- **複数測定対応**: 平均値・最大値・最小値を同一グラフに表示
- **ナビゲーション**: `navigateChart('prev'/'next')`で期間移動
- **24時間表示**: 1日表示時は00:00-23:59の固定範囲

### モードコントロールシステム
- **統一パネル**: 全機能を1箇所で制御
- **3つのモード**: 通常・追加・削除
- **視覚的フィードバック**: 色とアニメーションでモード表示

## これまでの主要な改善と修正

### 解決済みの重要な問題
1. **チャートの平均値 > 最大値問題**
   - **原因**: 異なるデータセット間での日付不一致
   - **解決**: 同一日付セットでの統一表示ロジック

2. **1日表示の24時間問題**
   - **原因**: Chart.jsの自動軸設定
   - **解決**: 固定min/max設定で強制24時間表示

3. **削除モードの動作不良**
   - **原因**: イベントリスナーの重複と競合
   - **解決**: `replaceWith(cloneNode)`による適切な要素置換

4. **保存フィードバック不足**
   - **問題**: 保存成功/失敗が視覚的に不明
   - **解決**: アニメーション付きボタン状態変更システム

5. **データ履歴の冗長性**
   - **問題**: 全履歴表示で縦スクロールが長大
   - **解決**: 直近7件制限での表示最適化

### localStorage永続化
- **実装済み**: カスタムタイミング・服装設定
- **目的**: ページ再読み込み時の設定保持

## 開発時の注意事項とベストプラクティス

### 必ず守るべき原則
1. **既存機能の保護**: 新機能追加時は既存のテストを必ず実行
2. **段階的テスト**: 各機能は単体で動作確認してから統合
3. **バックアップ**: 大きな変更前は必ず `index_backup_vXXX.html` を作成
4. **モジュラー開発**: 各タブは独立性を保って開発

### 陥りやすい罠と対策
1. **Chart.js破壊忘れ**: 新チャート作成前に必ず `weightChart.destroy()`
2. **イベントリスナー重複**: DOM操作時は既存リスナーの確認必須
3. **日付計算ミス**: タイムゾーンと日付跨ぎに注意
4. **Firebase非同期処理**: `async/await` または `.then()` で適切な待機

### コードの品質管理
- **関数の単一責任**: 1つの関数は1つの機能のみ
- **変数名の明確性**: 用途が即座に理解できる命名
- **エラーハンドリング**: 全ての非同期処理にtry-catch
- **ログ出力**: 重要な処理には必ず `log()` でトラッキング

## 今後の開発ロードマップ

### Phase 1: 機能の安定化
- 既存バグの完全排除
- パフォーマンス最適化
- ユーザビリティ改善

### Phase 2: タブ3の実装
- ユーザー要望に基づく機能設計
- 既存パターンに従ったモジュラー実装

### Phase 3: 高度な機能
- データエクスポート機能の拡充
- グラフの詳細カスタマイズ
- 複数ユーザー間でのデータ共有

### Phase 4: モバイル最適化
- PWA対応
- オフライン機能
- プッシュ通知

## ファイル構造

```
weight-management-app/
├── index.html                 # メインアプリケーション
├── custom/
│   ├── styles.css            # 共通スタイル
│   └── app-config.js         # Firebase設定
├── tabs/
│   ├── tab1-weight/          # 体重管理
│   │   ├── weight.html
│   │   ├── weight.js
│   │   └── weight.css
│   ├── tab2-sleep/           # 睡眠管理
│   │   ├── sleep.html
│   │   ├── sleep.js
│   │   └── sleep.css
│   └── tab3-xxx3/            # 未実装
│       ├── xxx3.html
│       ├── xxx3.js
│       └── xxx3.css
└── PROJECT_HANDOVER.md       # この文書
```

## 開発環境とデプロイ

### 必要なツール
- **GitHub Pages**: 自動デプロイ
- **Firebase Console**: データベース管理
- **Chrome DevTools**: デバッグとテスト

### デプロイメント
- **自動**: main ブランチへのpush時
- **URL**: https://[username].github.io/[repository]
- **設定**: GitHub Actionsによる自動ビルド

## 重要な設計決定の理由

### なぜタブベースにしたか
1. **拡張性**: 新機能を独立して追加可能
2. **ユーザビリティ**: 機能ごとの明確な分離
3. **保守性**: モジュール単位での開発・修正
4. **性能**: 必要な機能のみ読み込み

### なぜ0.01刻みバージョンか
1. **細かい変更の追跡**: 小さな修正も記録
2. **ロールバック容易性**: 問題発生時の特定が簡単
3. **開発進捗の可視化**: 継続的な改善の証明

### なぜFirebase Realtime Databaseか
1. **リアルタイム同期**: 複数デバイス間での即座な反映
2. **スケーラビリティ**: ユーザー増加への対応
3. **認証連携**: Google認証との自然な統合
4. **コスト効率**: 小規模利用での無料枠

## 最後に

このプロジェクトは**継続的な改善**を前提として設計されています。新しい開発者は：

1. まず既存機能を完全に理解する
2. 小さな改善から始める
3. ユーザーフィードバックを重視する
4. 常にコードの品質を意識する

以上の原則を守ることで、安全で効率的な開発を継続できます。