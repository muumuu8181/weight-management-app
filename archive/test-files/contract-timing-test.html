<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>å¥‘ç´„æ¤œå‡ºã‚¿ã‚¤ãƒŸãƒ³ã‚°ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .error { color: red; }
        .success { color: green; }
        button { padding: 10px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ¤œå‡ºã‚¿ã‚¤ãƒŸãƒ³ã‚°ãƒ†ã‚¹ãƒˆ</h1>
    
    <div class="section">
        <h2>1. ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®æ¤œå‡º</h2>
        <p id="loadResult">ãƒ†ã‚¹ãƒˆä¸­...</p>
    </div>
    
    <div class="section">
        <h2>2. ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚ã®æ¤œå‡º</h2>
        <button onclick="testClickDetection()">å¥‘ç´„é•åã‚’å®Ÿè¡Œ</button>
        <button onclick="testValidFunction()">æ­£å¸¸ãªå‡¦ç†ã‚’å®Ÿè¡Œ</button>
        <p id="clickResult"></p>
    </div>
    
    <div class="section">
        <h2>3. Firebaseæ“ä½œæ™‚ã®æ¤œå‡º</h2>
        <button onclick="testFirebaseError()">Firebaseå¥‘ç´„é•å</button>
        <p id="firebaseResult"></p>
    </div>
    
    <div class="section">
        <h2>4. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œæ™‚ã®æ¤œå‡º</h2>
        <input type="text" id="testField" placeholder="ãƒ†ã‚¹ãƒˆå…¥åŠ›">
        <button onclick="testValidationError()">ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å¥‘ç´„é•å</button>
        <p id="validationResult"></p>
    </div>
    
    <div class="section">
        <h2>æ¤œå‡ºãƒ­ã‚°</h2>
        <div id="log" style="background: #f5f5f5; padding: 10px; max-height: 200px; overflow-y: auto;"></div>
    </div>

    <!-- å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
    <script src="shared/utils/contract.js"></script>
    
    <script>
        // ãƒ­ã‚°è¡¨ç¤ºé–¢æ•°
        function log(message, isError = false) {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = isError ? 'error' : 'success';
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        // 1. ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®ãƒ†ã‚¹ãƒˆ
        console.log('ğŸ” ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿é–‹å§‹...');
        
        // ã“ã®ã‚³ãƒ¼ãƒ‰ã¯ä»Šã™ãå®Ÿè¡Œã•ã‚Œã‚‹ãŒã€å¥‘ç´„é•åã¯ãªã„
        try {
            Contract.require(true, 'æ­£å¸¸ãªæ¡ä»¶');
            document.getElementById('loadResult').innerHTML = 
                '<span class="success">âœ… ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ï¼šæ­£å¸¸ãªå¥‘ç´„ã¯é€šé</span>';
            log('ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ï¼šå¥‘ç´„ãƒã‚§ãƒƒã‚¯é€šé');
        } catch (e) {
            document.getElementById('loadResult').innerHTML = 
                `<span class="error">âŒ ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã‚¨ãƒ©ãƒ¼: ${e.message}</span>`;
            log(`ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã‚¨ãƒ©ãƒ¼: ${e.message}`, true);
        }
        
        // ã“ã®é–¢æ•°ã¯å®šç¾©ã•ã‚Œã‚‹ã ã‘ã§ã€å®Ÿè¡Œã•ã‚Œãªã„
        function hiddenContractViolation() {
            // ã“ã®å¥‘ç´„é•åã¯é–¢æ•°ãŒå‘¼ã°ã‚Œã‚‹ã¾ã§æ¤œå‡ºã•ã‚Œãªã„ï¼
            Contract.require(false, 'ã“ã®é–¢æ•°ãŒå‘¼ã°ã‚Œã‚‹ã¨å¥‘ç´„é•å');
            return 'ã“ã®é–¢æ•°ã¯å¥‘ç´„é•åã‚’å«ã‚€ãŒã€å‘¼ã°ã‚Œã‚‹ã¾ã§ã‚¨ãƒ©ãƒ¼ã«ãªã‚‰ãªã„';
        }
        
        // 2. ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚ã®ãƒ†ã‚¹ãƒˆ
        function testClickDetection() {
            try {
                log('ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ï¼šå¥‘ç´„é•åãƒ†ã‚¹ãƒˆå®Ÿè¡Œ');
                Contract.require(false, 'ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§å¥‘ç´„é•åç™ºç”Ÿ');
                document.getElementById('clickResult').innerHTML = 
                    '<span class="error">âŒ å¥‘ç´„é•åãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ</span>';
            } catch (e) {
                document.getElementById('clickResult').innerHTML = 
                    `<span class="success">âœ… ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚ã«å¥‘ç´„é•åæ¤œå‡º: ${e.message}</span>`;
                log(`ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚ã«å¥‘ç´„é•åæ¤œå‡º: ${e.message}`, true);
            }
        }
        
        function testValidFunction() {
            try {
                Contract.require(1 + 1 === 2, 'æ­£å¸¸ãªè¨ˆç®—');
                document.getElementById('clickResult').innerHTML = 
                    '<span class="success">âœ… æ­£å¸¸ãªå‡¦ç†ãŒå®Ÿè¡Œã•ã‚Œã¾ã—ãŸ</span>';
                log('æ­£å¸¸ãªå‡¦ç†ãŒå®Ÿè¡Œã•ã‚Œã¾ã—ãŸ');
            } catch (e) {
                document.getElementById('clickResult').innerHTML = 
                    `<span class="error">âŒ äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼: ${e.message}</span>`;
                log(`äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼: ${e.message}`, true);
            }
        }
        
        // 3. Firebaseæ“ä½œæ™‚ã®ãƒ†ã‚¹ãƒˆï¼ˆæ¨¡æ“¬ï¼‰
        function testFirebaseError() {
            try {
                log('Firebaseæ“ä½œãƒ†ã‚¹ãƒˆï¼šå¥‘ç´„é•åã‚’å®Ÿè¡Œ');
                // Firebase CRUDã‚¯ãƒ©ã‚¹ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ãªã„å ´åˆã®æ¨¡æ“¬
                if (typeof FirebaseCRUD === 'undefined') {
                    // å¥‘ç´„ãƒã‚§ãƒƒã‚¯ã‚’æ¨¡æ“¬
                    Contract.require(false, 'FirebaseæœªåˆæœŸåŒ–çŠ¶æ…‹ã§ã®æ“ä½œè©¦è¡Œ');
                } else {
                    // å®Ÿéš›ã®Firebaseå¥‘ç´„é•å
                    FirebaseCRUD.save(null, null, null);
                }
                document.getElementById('firebaseResult').innerHTML = 
                    '<span class="error">âŒ Firebaseå¥‘ç´„é•åãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ</span>';
            } catch (e) {
                document.getElementById('firebaseResult').innerHTML = 
                    `<span class="success">âœ… Firebaseæ“ä½œæ™‚ã«å¥‘ç´„é•åæ¤œå‡º: ${e.message}</span>`;
                log(`Firebaseæ“ä½œæ™‚ã«å¥‘ç´„é•åæ¤œå‡º: ${e.message}`, true);
            }
        }
        
        // 4. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œæ™‚ã®ãƒ†ã‚¹ãƒˆ
        function testValidationError() {
            try {
                log('ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å¥‘ç´„é•åãƒ†ã‚¹ãƒˆå®Ÿè¡Œ');
                // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ãªã„å ´åˆã®æ¨¡æ“¬
                if (typeof UniversalValidator === 'undefined') {
                    // å¥‘ç´„ãƒã‚§ãƒƒã‚¯ã‚’æ¨¡æ“¬
                    Contract.requireArray(null, 'fieldsé…åˆ—', false);
                } else {
                    // å®Ÿéš›ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å¥‘ç´„é•å
                    UniversalValidator.validateRequired(null);
                }
                document.getElementById('validationResult').innerHTML = 
                    '<span class="error">âŒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å¥‘ç´„é•åãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ</span>';
            } catch (e) {
                document.getElementById('validationResult').innerHTML = 
                    `<span class="success">âœ… ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ™‚ã«å¥‘ç´„é•åæ¤œå‡º: ${e.message}</span>`;
                log(`ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ™‚ã«å¥‘ç´„é•åæ¤œå‡º: ${e.message}`, true);
            }
        }
        
        // 5. é…å»¶å®Ÿè¡Œã§ã®æ¤œå‡ºãƒ†ã‚¹ãƒˆ
        console.log('ğŸ” 3ç§’å¾Œã«é…å»¶å®Ÿè¡Œãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...');
        setTimeout(() => {
            try {
                log('é…å»¶å®Ÿè¡Œï¼šå¥‘ç´„é•åãƒ†ã‚¹ãƒˆ');
                Contract.require(false, '3ç§’å¾Œã®é…å»¶å®Ÿè¡Œã§å¥‘ç´„é•å');
            } catch (e) {
                log(`é…å»¶å®Ÿè¡Œã§å¥‘ç´„é•åæ¤œå‡º: ${e.message}`, true);
            }
        }, 3000);
        
        // 6. æ¡ä»¶ä»˜ãå®Ÿè¡Œï¼ˆã“ã®ä¾‹ã§ã¯å®Ÿè¡Œã•ã‚Œãªã„ï¼‰
        if (false) {
            // ã“ã®ãƒ–ãƒ­ãƒƒã‚¯ã¯å®Ÿè¡Œã•ã‚Œãªã„ã®ã§ã€å¥‘ç´„é•åã‚‚æ¤œå‡ºã•ã‚Œãªã„
            Contract.require(false, 'ã“ã®å¥‘ç´„é•åã¯å®Ÿè¡Œã•ã‚Œãªã„ã®ã§æ¤œå‡ºã•ã‚Œãªã„');
        }
        
        log('ãƒšãƒ¼ã‚¸åˆæœŸåŒ–å®Œäº†ï¼šå¥‘ç´„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæº–å‚™OK');
        console.log('ğŸ” å…¨ãƒ†ã‚¹ãƒˆæº–å‚™å®Œäº†ã€‚ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦å„ç¨®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚');
    </script>
</body>
</html>