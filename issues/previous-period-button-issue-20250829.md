# 前期間の記録ボタン機能不全問題

**報告日**: 2025年8月29日  
**バージョン**: v0.67  
**報告者**: ユーザー  

## 問題概要

「前期間の記録」ボタンを押下してもグラフに前期間データが表示されない。

## 現象詳細

### 正常な動作（ボタンUI）
- ✅ ボタン色変化: 緑色「前期間の記録」→ 赤色「前期間OFF」
- ✅ ログ出力: `📊 前期間比較: ON/OFF` が正しく表示

### 異常な動作（グラフ表示）
- ❌ グラフに前期間データが追加表示されない
- ❌ 現在期間のデータのみ表示される（変化なし）

## 確認済み情報

### データ存在確認
- 前日データは存在する（前ボタンでナビゲーション時に表示される）
- 例：8/29表示中に前ボタンで8/28データは正常表示
- データ不足が原因ではない

### ログ分析
```
📊 前期間比較: ON
📊 グラフ更新: 11件のデータ表示 8/29のデータ
```
- 前期間比較ONでもグラフ更新は現在期間のみ
- 前期間データが取得・追加されていない可能性

## 想定原因

1. **データ取得問題**: `getPreviousPeriodData()`関数が正しく動作していない
2. **Chart.js設定問題**: 複数データセットの設定に不備
3. **日付計算問題**: 前期間の日付範囲計算が間違っている

## 期待動作

### 1日表示の場合
- 現在: 8/29のデータのみ表示
- 期待: 8/29のデータ（青線）+ 8/28のデータ（灰色破線）

### 1週間表示の場合
- 現在: 今週のデータのみ表示
- 期待: 今週のデータ（青線）+ 前週のデータ（灰色破線）

## 次のアクション

1. `getPreviousPeriodData()`関数のデバッグ
2. データセット追加処理の確認
3. Chart.js設定の検証
4. 修正後のv0.68リリース

## 技術詳細

**関連ファイル**: `index.html`  
**関連関数**:
- `togglePreviousPeriod()` - ボタン制御（正常）
- `getPreviousPeriodData()` - データ取得（要調査）
- `renderChartWithData()` - グラフ描画（要調査）

**実装場所**:
- ボタン: line 274
- 状態管理: line 494
- データ取得: line 1915-1929
- グラフ追加: line 1564-1589, 1691-1721